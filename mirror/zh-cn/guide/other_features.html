<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>xmake</title>
  <link rel="icon" href="/assets/img/favicon.ico">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <meta name="description" content="Description">
  <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
  <link href="//cdn.jsdelivr.net/npm/github-markdown-css@4.0.0/github-markdown.min.css" rel="stylesheet">
  <style>
	.markdown-body {
		box-sizing: border-box;
		min-width: 200px;
		max-width: 980px;
		margin: 0 auto;
		padding: 45px;
	}

	@media (max-width: 767px) {
		.markdown-body {
			padding: 15px;
		}
	}
  </style>
</head>
<body>
<article class="markdown-body">
<h4>This is a mirror page, please see the original page: </h4><a href="https://xmake.io/#/zh-cn/guide/other_features">https://xmake.io/#/zh-cn/guide/other_features</a>
</br>
    <script async type="text/javascript" src="//cdn.carbonads.com/carbon.js?serve=CE7I52QU&placement=xmakeio" id="_carbonads_js"></script>
<style>
#carbonads {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen-Sans, Ubuntu,
  Cantarell, "Helvetica Neue", Helvetica, Arial, sans-serif;
}

#carbonads {
  display: flex;
  max-width: 330px;
  background-color: hsl(0, 0%, 98%);
  box-shadow: 0 1px 4px 1px hsla(0, 0%, 0%, .1);
}

#carbonads a {
  color: inherit;
  text-decoration: none;
}

#carbonads a:hover {
  color: inherit;
}

#carbonads span {
  position: relative;
  display: block;
  overflow: hidden;
}

#carbonads .carbon-wrap {
  display: flex;
}

.carbon-img {
  display: block;
  margin: 0;
  line-height: 1;
}

.carbon-img img {
  display: block;
}

.carbon-text {
  font-size: 13px;
  padding: 10px;
  line-height: 1.5;
  text-align: left;
}

.carbon-poweredby {
  display: block;
  padding: 8px 10px;
  background: repeating-linear-gradient(-45deg, transparent, transparent 5px, hsla(0, 0%, 0%, .025) 5px, hsla(0, 0%, 0%, .025) 10px) hsla(203, 11%, 95%, .4);
  text-align: center;
  text-transform: uppercase;
  letter-spacing: .5px;
  font-weight: 600;
  font-size: 9px;
  line-height: 1;
}
</style>
    <h2 id="trybuild">å°è¯•ä½¿ç”¨å…¶ä»–æ„å»ºç³»ç»Ÿæ„å»ºï¼ˆTryBuild æ¨¡å¼ï¼‰</h2>
<p>xmake v2.3.1ä»¥ä¸Šç‰ˆæœ¬ç›´æ¥å¯¹æ¥äº†å…¶ä»–ç¬¬ä¸‰æ–¹æ„å»ºç³»ç»Ÿï¼Œå³ä½¿å…¶ä»–é¡¹ç›®ä¸­æ²¡æœ‰ä½¿ç”¨xmake.luaæ¥ç»´æŠ¤ï¼Œxmakeä¹Ÿå¯ä»¥ç›´æ¥è°ƒç”¨å…¶ä»–æ„å»ºå·¥å…·æ¥å®Œæˆç¼–è¯‘ã€‚</p>
<p>é‚£ç”¨æˆ·ç›´æ¥è°ƒç”¨ä½¿ç”¨ç¬¬ä¸‰æ–¹æ„å»ºå·¥å…·æ¥ç¼–è¯‘ä¸å°±è¡Œäº†ï¼Œä¸ºå•¥è¿˜è¦ç”¨xmakeå»è°ƒç”¨å‘¢ï¼Ÿä¸»è¦æœ‰ä»¥ä¸‹å¥½å¤„ï¼š</p>
<ol>
<li>å®Œå…¨çš„è¡Œä¸ºä¸€è‡´ï¼Œç®€åŒ–ç¼–è¯‘æµç¨‹ï¼Œä¸ç®¡ç”¨äº†å“ªä¸ªå…¶ä»–æ„å»ºç³»ç»Ÿï¼Œéƒ½åªéœ€è¦æ‰§è¡Œxmakeè¿™ä¸ªå‘½ä»¤å°±å¯ä»¥ç¼–è¯‘ï¼Œç”¨æˆ·ä¸å†éœ€è¦å»ç ”ç©¶å…¶ä»–å·¥å…·çš„ä¸åŒçš„ç¼–è¯‘æµç¨‹</li>
<li>å®Œå…¨å¯¹æ¥<code>xmake config</code>çš„é…ç½®ç¯å¢ƒï¼Œå¤ç”¨xmakeçš„å¹³å°æ¢æµ‹å’Œsdkç¯å¢ƒæ£€æµ‹ï¼Œç®€åŒ–å¹³å°é…ç½®</li>
<li>å¯¹æ¥äº¤å‰ç¼–è¯‘ç¯å¢ƒï¼Œå³ä½¿æ˜¯ç”¨autotoolsç»´æŠ¤çš„é¡¹ç›®ï¼Œä¹Ÿèƒ½é€šè¿‡xmakeå¿«é€Ÿå®ç°äº¤å‰ç¼–è¯‘</li>
</ol>
<p>ç›®å‰å·²æ”¯æŒçš„æ„å»ºç³»ç»Ÿï¼š</p>
<ul>
<li>autotoolsï¼ˆå·²å®Œå…¨å¯¹æ¥xmakeçš„äº¤å‰ç¼–è¯‘ç¯å¢ƒï¼‰</li>
<li>xcodebuild</li>
<li>cmakeï¼ˆå·²å®Œå…¨å¯¹æ¥xmakeçš„äº¤å‰ç¼–è¯‘ç¯å¢ƒï¼‰</li>
<li>make</li>
<li>msbuild</li>
<li>scons</li>
<li>meson</li>
<li>bazel</li>
<li>ndkbuild</li>
<li>ninja</li>
</ul>
<h3 id="">è‡ªåŠ¨æ¢æµ‹æ„å»ºç³»ç»Ÿå¹¶ç¼–è¯‘</h3>
<p>ä¾‹å¦‚ï¼Œå¯¹äºä¸€ä¸ªä½¿ç”¨cmakeç»´æŠ¤çš„é¡¹ç›®ï¼Œç›´æ¥åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œxmakeï¼Œå°±ä¼šè‡ªåŠ¨è§¦å‘æ¢æµ‹æœºåˆ¶ï¼Œæ£€æµ‹åˆ°CMakeLists.txtï¼Œç„¶åæç¤ºç”¨æˆ·æ˜¯å¦éœ€è¦ä½¿ç”¨cmakeæ¥ç»§ç»­å®Œæˆç¼–è¯‘ã€‚</p>
<pre><code class="lang-bash">$ xmake
note: CMakeLists.txt found, try building it (pass -y or --confirm=y/n/d to skip confirm)?
please input: y (y/n)
-- Symbol prefix:
-- Configuring done
-- Generating done
-- Build files have been written to: /Users/ruki/Downloads/libpng-1.6.35/build
[  7%] Built target png-fix-itxt
[ 21%] Built target genfiles
[ 81%] Built target png
[ 83%] Built target png_static
...
output to /Users/ruki/Downloads/libpng-1.6.35/build/artifacts
build ok!
</code></pre>
<h3 id="xmake">æ— ç¼å¯¹æ¥xmakeå‘½ä»¤</h3>
<p>ç›®å‰æ”¯æŒ<code>xmake clean</code>, <code>xmake --rebuild</code>å’Œ<code>xmake config</code>ç­‰å¸¸ç”¨å‘½ä»¤ä¸ç¬¬ä¸‰æ–¹ç³»ç»Ÿçš„æ— ç¼å¯¹æ¥ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥ç›´æ¥æ¸…ç†cmakeç»´æŠ¤é¡¹ç›®çš„ç¼–è¯‘è¾“å‡ºæ–‡ä»¶</p>
<pre><code class="lang-bash">$ xmake clean
$ xmake clean --all
</code></pre>
<p>å¦‚æœå¸¦ä¸Š<code>--all</code>æ‰§è¡Œæ¸…ç†ï¼Œä¼šæ¸…é™¤autotools/cmakeç”Ÿæˆçš„æ‰€æœ‰æ–‡ä»¶ï¼Œä¸ä»…ä»…åªæ¸…ç†å¯¹è±¡æ–‡ä»¶ã€‚</p>
<p>é»˜è®¤<code>xmake</code>å¯¹æ¥çš„æ˜¯å¢é‡æ„å»ºè¡Œä¸ºï¼Œä¸è¿‡æˆ‘ä»¬ä¹Ÿå¯ä»¥å¼ºåˆ¶å¿«é€Ÿé‡å»ºï¼š</p>
<pre><code class="lang-bash">$ xmake --rebuild
</code></pre>
<h3 id="">æ‰‹åŠ¨åˆ‡æ¢æŒ‡å®šæ„å»ºç³»ç»Ÿ</h3>
<p>å¦‚æœä¸€ä¸ªé¡¹ç›®ä¸‹æœ‰å¤šä¸ªæ„å»ºç³»ç»ŸåŒæ—¶åœ¨ç»´æŠ¤ï¼Œæ¯”å¦‚libpngé¡¹ç›®ï¼Œè‡ªå¸¦autotools/cmake/makefileç­‰æ„å»ºç³»ç»Ÿç»´æŠ¤ï¼Œxmakeé»˜è®¤ä¼˜å…ˆæ¢æµ‹ä½¿ç”¨äº†autotoolsï¼Œå¦‚æœæƒ³è¦å¼ºåˆ¶åˆ‡æ¢å…¶ä»–æ„å»ºç³»ç»Ÿï¼Œå¯ä»¥æ‰§è¡Œï¼š</p>
<pre><code class="lang-bash">$ xmake f --trybuild=[autotools|cmake|make|msbuild| ..]
$ xmake
</code></pre>
<p>å¦å¤–ï¼Œé…ç½®äº†<code>--trybuild=</code>å‚æ•°æ‰‹åŠ¨æŒ‡å®šäº†é»˜è®¤çš„æ„å»ºç³»ç»Ÿï¼Œåç»­çš„buildè¿‡ç¨‹å°±ä¸ä¼šé¢å¤–æç¤ºç”¨æˆ·é€‰æ‹©äº†ã€‚</p>
<h3 id="">å®ç°å¿«é€Ÿäº¤å‰ç¼–è¯‘</h3>
<p>ä¼—æ‰€å‘¨çŸ¥ï¼Œcmake/autotoolsç»´æŠ¤çš„é¡¹ç›®è™½ç„¶å¾ˆå¤šéƒ½æ”¯æŒäº¤å‰ç¼–è¯‘ï¼Œä½†æ˜¯äº¤å‰ç¼–è¯‘çš„é…ç½®è¿‡ç¨‹å¾ˆå¤æ‚ï¼Œä¸åŒçš„å·¥å…·é“¾å¤„ç†æ–¹å¼è¿˜æœ‰å¾ˆå¤šçš„å·®å¼‚ï¼Œä¸­é€”ä¼šè¸©åˆ°å¾ˆå¤šçš„å‘ã€‚</p>
<p>å³ä½¿è·‘é€šäº†ä¸€ä¸ªå·¥å…·é“¾çš„äº¤å‰ç¼–è¯‘ï¼Œå¦‚æœåˆ‡åˆ°å¦å¤–ä¸€ä¸ªå·¥å…·é“¾ç¯å¢ƒï¼Œå¯èƒ½åˆè¦æŠ˜è…¾å¥½ä¹…ï¼Œè€Œå¦‚æœä½¿ç”¨xmakeï¼Œé€šå¸¸åªéœ€è¦ä¸¤æ¡ç®€å•çš„å‘½ä»¤å³å¯ï¼š</p>
<p>!> ç›®å‰cmake/autotoolséƒ½å·²å¯¹æ¥æ”¯æŒäº†xmakeçš„äº¤å‰ç¼–è¯‘ã€‚</p>
<h4 id="android">äº¤å‰ç¼–è¯‘androidå¹³å°</h4>
<pre><code class="lang-bash">$ xmake f -p android --trybuild=autotools [--ndk=xxx]
$ xmake
</code></pre>
<p>!> å…¶ä¸­ï¼Œ--ndkå‚æ•°é…ç½®æ˜¯å¯é€‰çš„ï¼Œå¦‚æœç”¨æˆ·è®¾ç½®äº†ANDROID_NDK_HOMEç¯å¢ƒå˜é‡ï¼Œæˆ–è€…ndkæ”¾ç½®åœ¨~/Library/Android/sdk/ndk-bundleï¼Œxmakeéƒ½èƒ½è‡ªåŠ¨æ£€æµ‹åˆ°ã€‚</p>
<p>æ˜¯ä¸æ˜¯å¾ˆç®€å•ï¼Ÿå¦‚æœä½ è§‰å¾—è¿™æ²¡å•¥ï¼Œé‚£ä¹ˆå¯ä»¥å¯¹æ¯”ä¸‹ç›´æ¥æ“ä½œ<code>./configure</code>å»é…ç½®äº¤å‰ç¼–è¯‘ï¼Œå¯ä»¥çœ‹ä¸‹è¿™ç¯‡æ–‡æ¡£å¯¹æ¯”ä¸‹ï¼š<a href="https://developer.android.com/ndk/guides/other_build_systems#autoconf">å°†NDK ä¸å…¶ä»–ç¼–è¯‘ç³»ç»Ÿé…åˆä½¿ç”¨</a></p>
<p>è¯´ç™½äº†ï¼Œä½ å¤§æ¦‚å¾—è¿™æ ·ï¼Œè¿˜ä¸ä¸€å®šä¸€æ¬¡å°±èƒ½æå®šï¼š</p>
<pre><code class="lang-bash">$ export TOOLCHAIN=$NDK/toolchains/llvm/prebuilt/$HOST_TAG
$ export AR=$TOOLCHAIN/bin/aarch64-linux-android-ar
$ export AS=$TOOLCHAIN/bin/aarch64-linux-android-as
$ export CC=$TOOLCHAIN/bin/aarch64-linux-android21-clang
$ export CXX=$TOOLCHAIN/bin/aarch64-linux-android21-clang++
$ export LD=$TOOLCHAIN/bin/aarch64-linux-android-ld
$ export RANLIB=$TOOLCHAIN/bin/aarch64-linux-android-ranlib
$ export STRIP=$TOOLCHAIN/bin/aarch64-linux-android-strip
$ ./configure --host aarch64-linux-android
$ make
</code></pre>
<p>å¦‚æœæ˜¯cmakeå‘¢ï¼Œäº¤å‰ç¼–è¯‘ä¹Ÿä¸çœäº‹ï¼Œå¯¹äºandroidå¹³å°ï¼Œå¾—è¿™ä¹ˆé…ç½®ã€‚</p>
<pre><code class="lang-bash">$ cmake \
    -DCMAKE_TOOLCHAIN_FILE=$NDK/build/cmake/android.toolchain.cmake \
    -DANDROID_ABI=$ABI \
    -DANDROID_NATIVE_API_LEVEL=$MINSDKVERSION \
    $OTHER_ARGS
</code></pre>
<p>è€Œå¯¹äº ios å¹³å°ï¼Œæ²¡æ‰¾åˆ°ç®€ç­”çš„é…ç½®æ–¹å¼ï¼Œå°±æ‰¾åˆ°ä¸ªç¬¬ä¸‰æ–¹çš„ ios å·¥å…·é“¾é…ç½®ï¼Œå¾ˆå¤æ‚ï¼š<a href="https://github.com/leetal/ios-cmake/blob/master/ios.toolchain.cmake">https://github.com/leetal/ios-cmake/blob/master/ios.toolchain.cmake</a></p>
<p>å¯¹äº mingw åˆæ˜¯å¦å¤–ä¸€ç§æ–¹å¼ï¼Œæˆ‘åˆæŠ˜è…¾äº†åŠå¤©ç¯å¢ƒï¼Œå¾ˆæ˜¯æŠ˜è…¾ã€‚</p>
<p>è€Œå¯¹æ¥äº†xmakeåï¼Œä¸ç®¡æ˜¯cmakeè¿˜æ˜¯autotoolsï¼Œäº¤å‰ç¼–è¯‘éƒ½æ˜¯éå¸¸ç®€å•çš„ï¼Œè€Œä¸”é…ç½®æ–¹å¼ä¹Ÿå®Œå…¨ä¸€æ ·ï¼Œç²¾ç®€ä¸€è‡´ã€‚</p>
<h4 id="iphoneos">äº¤å‰ç¼–è¯‘iphoneoså¹³å°</h4>
<pre><code class="lang-bash">$ xmake f -p iphoneos --trybuild=[cmake|autotools]
$ xmake
</code></pre>
<h4 id="mingw">äº¤å‰ç¼–è¯‘mingwå¹³å°</h4>
<pre><code class="lang-bash">$ xmake f -p mingw --trybuild=[cmake|autotools] [--mingw=xxx]
$ xmake
</code></pre>
<h4 id="">ä½¿ç”¨å…¶ä»–äº¤å‰ç¼–è¯‘å·¥å…·é“¾</h4>
<pre><code class="lang-bash">$ xmake f -p cross --trybuild=[cmake|autotools] --sdk=/xxxx
$ xmake
</code></pre>
<p>å…³äºæ›´å¤šäº¤å‰ç¼–è¯‘çš„é…ç½®ç»†èŠ‚ï¼Œè¯·å‚è€ƒæ–‡æ¡£ï¼š<a href="https://xmake.io/#/zh-cn/guide/configuration?id=%e4%ba%a4%e5%8f%89%e7%bc%96%e8%af%91">äº¤å‰ç¼–è¯‘</a>ï¼Œé™¤äº†å¤šäº†ä¸€ä¸ª<code>--trybuild=</code>å‚æ•°ï¼Œå…¶ä»–äº¤å‰ç¼–è¯‘é…ç½®å‚æ•°éƒ½æ˜¯å®Œå…¨é€šç”¨çš„ã€‚</p>
<h3 id="">ä¼ é€’ç”¨æˆ·é…ç½®å‚æ•°</h3>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡<code>--tryconfigs=</code>æ¥ä¼ é€’ç”¨æˆ·é¢å¤–çš„é…ç½®å‚æ•°åˆ°å¯¹åº”çš„ç¬¬ä¸‰æ–¹æ„å»ºç³»ç»Ÿï¼Œæ¯”å¦‚ï¼šautotoolsä¼šä¼ é€’ç»™<code>./configure</code>ï¼Œcmakeä¼šä¼ é€’ç»™<code>cmake</code>å‘½ä»¤ã€‚</p>
<pre><code class="lang-bash">$ xmake f --trybuild=autotools --tryconfigs="--enable-shared=no"
$ xmake
</code></pre>
<p>æ¯”å¦‚ä¸Šè¿°å‘½ä»¤ï¼Œä¼ é€’<code>--enable-shared=no</code>ç»™<code>./configure</code>ï¼Œæ¥ç¦ç”¨åŠ¨æ€åº“ç¼–è¯‘ã€‚</p>
<p>å¦å¤–ï¼Œå¯¹äº<code>--cflags</code>, <code>--includedirs</code>å’Œ<code>--ldflags</code>ç­‰å‚æ•°ï¼Œä¸éœ€è¦é€šè¿‡<code>--tryconfigs</code>ï¼Œé€šè¿‡<code>xmake config --cflags=</code>ç­‰å†…ç½®å‚æ•°å°±å¯é€ä¼ è¿‡å»ã€‚</p>
<h3 id="">ç¼–è¯‘å…¶ä»–æ„å»ºç³»ç»Ÿè¿‡ç¨‹ç¤ºä¾‹</h3>
<h4 id="">é€šç”¨ç¼–è¯‘æ–¹å¼</h4>
<p>å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæ¯ä¸ªæ„å»ºç³»ç»Ÿå¯¹æ¥åçš„ç¼–è¯‘æ–¹å¼éƒ½æ˜¯ä¸€è‡´çš„ï¼Œé™¤äº†<code>--trybuild=</code>é…ç½®å‚æ•°é™¤å¤–ã€‚</p>
<pre><code class="lang-bash">$ xmake f --trybuild=[autotools|cmake|meson|ninja|bazel|make|msbuild|xcodebuild]
$ xmake
</code></pre>
<p>!> æˆ‘ä»¬è¿˜éœ€è¦ç¡®ä¿--trybuildæŒ‡å®šçš„æ„å»ºå·¥å…·å·²ç»å®‰è£…èƒ½å¤Ÿæ­£å¸¸ä½¿ç”¨ã€‚</p>
<h4 id="androidjni">æ„å»ºAndroid jniç¨‹åº</h4>
<p>å¦‚æœå½“å‰é¡¹ç›®ä¸‹å­˜åœ¨<code>jni/Android.mk</code>ï¼Œé‚£ä¹ˆxmakeå¯ä»¥ç›´æ¥è°ƒç”¨ndk-buildæ¥æ„å»ºjniåº“ã€‚</p>
<pre><code class="lang-bash">$ xmake f -p android --trybuild=ndkbuild [--ndk=]
$ xmake
</code></pre>
<p>å¦‚æœè§‰å¾—å‘½ä»¤è¡Œç¼–è¯‘jniæ¯”è¾ƒéº»çƒ¦ï¼Œxmakeä¹Ÿæä¾›äº†ç›¸å…³çš„gradleé›†æˆæ’ä»¶<a href="https://github.com/xmake-io/xmake-gradle">xmake-gradle</a>ï¼Œå¯ä»¥æ— ç¼é›†æˆxmakeè¿›è¡Œjniåº“çš„ç¼–è¯‘é›†æˆï¼Œå…·ä½“è¯¦æƒ…è§ï¼š<a href="https://xmake.io/#/zh-cn/plugin/more_plugins?id=gradle%e6%8f%92%e4%bb%b6%ef%bc%88jni%ef%bc%89">ä½¿ç”¨xmake-gradleæ’ä»¶æ„å»ºJNIç¨‹åº</a></p>
<h2 id="xmakelua">è‡ªåŠ¨æ‰«ææºç ç”Ÿæˆxmake.lua</h2>
<p>å¯¹äºä¸€ä»½å·¥ç¨‹æºç ï¼Œå¯ä»¥ä¸ç”¨ç¼–å†™makefileï¼Œä¹Ÿä¸ç”¨ç¼–å†™å„ç§makeç›¸å…³çš„å·¥ç¨‹æè¿°æ–‡ä»¶ï¼ˆä¾‹å¦‚ï¼šxmake.luaï¼Œmakefile.am, cmakelist.txtç­‰ï¼‰</p>
<p>xmakeå°±å¯ä»¥ç›´æ¥ç¼–è¯‘ä»–ä»¬ï¼Œè¿™æ˜¯å¦‚ä½•åšåˆ°çš„å‘¢ï¼Œç®€å•æ¥è¯´ä¸‹å®ç°åŸç†ï¼š</p>
<ol>
<li>é¦–å…ˆæ‰«æå½“å‰ç›®å½•ä¸‹ï¼Œxmakeæ‰€ä»¥æ”¯æŒçš„æ‰€æœ‰æºä»£ç æ–‡ä»¶</li>
<li>åˆ†æä»£ç ï¼Œæ£€æµ‹å“ªäº›ä»£ç æ‹¥æœ‰mainå…¥å£å‡½æ•°</li>
<li>æ‰€æœ‰æ²¡æœ‰mainå…¥å£çš„ä»£ç ç¼–è¯‘æˆé™æ€åº“</li>
<li>å¸¦æœ‰mainå…¥å£çš„ä»£ç ï¼Œç¼–è¯‘æˆå¯æ‰§è¡Œç¨‹åºï¼ŒåŒæ—¶é“¾æ¥å…¶ä»–é™æ€åº“ç¨‹åº</li>
</ol>
<p>è¿™ç§ä»£ç æ‰«æå’Œæ™ºèƒ½ç¼–è¯‘ï¼Œéå¸¸ç®€å•ï¼Œç›®å‰xmakeè¿˜ä¸æ”¯æŒå¤šçº§ç›®å½•æ‰«æï¼Œåªå¯¹å•çº§ç›®å½•çš„ä»£ç è¿›è¡Œæ‰«æç¼–è¯‘ã€‚ã€‚</p>
<h3 id="">ä½¿ç”¨åœºæ™¯</h3>
<ol>
<li>ä¸´æ—¶å¿«é€Ÿç¼–è¯‘å’Œè¿è¡Œä¸€äº›é›¶æ•£çš„æµ‹è¯•ä»£ç </li>
<li>å°è¯•å¯¹å…¶ä»–å¼€æºåº“åšç§»æ¤ç¼–è¯‘</li>
<li>å¿«é€ŸåŸºäºç°æœ‰ä»£ç åˆ›å»ºæ–°xmakeå·¥ç¨‹</li>
</ol>
<h3 id="">å¦‚ä½•ä½¿ç”¨</h3>
<p>ç›´æ¥åœ¨å¸¦æœ‰æºç çš„ç›®å½•ï¼ˆæ²¡æœ‰xmake.luaï¼‰ä¸‹æ‰§è¡Œxmakeï¼Œç„¶åæ ¹æ®æç¤ºæ“ä½œï¼š</p>
<pre><code class="lang-bash">$ xmake
note: xmake.lua not found, try generating it (pass -y or --confirm=y/n/d to skip confirm)?
please input: n (y/n)
y
</code></pre>
<h3 id="">å¼€æºä»£ç çš„ç§»æ¤å’Œç¼–è¯‘</h3>
<p>è™½ç„¶è¿™ç§æ–¹å¼ï¼Œå¹¶ä¸æ˜¯éå¸¸æ™ºèƒ½ï¼Œé™åˆ¶ä¹Ÿä¸å°‘ï¼Œä½†æ˜¯å¯¹äºæƒ³ä¸´æ—¶å†™äº›ä»£ç è¿›è¡Œç¼–è¯‘è¿è¡Œï¼Œæˆ–è€…ä¸´æ—¶æƒ³äº¤å‰ç¼–è¯‘ä¸€äº›ç®€å•çš„å¼€æºåº“ä»£ç </p>
<p>è¿™ç§æ–¹å¼å·²ç»è¶³å¤Ÿä½¿ç”¨äº†ï¼Œä¸‹é¢çœ‹ä¸‹ä¸€ä¸ªå®é™…çš„ä¾‹å­ï¼š</p>
<p>æˆ‘ä¸‹è½½äº†ä¸€ä»½zlib-1.2.10çš„æºç ï¼Œæƒ³è¦ç¼–è¯‘å®ƒï¼Œåªéœ€è¦è¿›å…¥zlibçš„æºç ç›®å½•æ‰§è¡Œï¼š</p>
<pre><code class="lang-bash">$ cd zlib-1.2.10
$ xmake
note: xmake.lua not found, try generating it (pass -y or --confirm=y/n/d to skip confirm)?
please input: n (y/n)
y
</code></pre>
<p>å°±è¡Œäº†ï¼Œè¾“å…¥yç¡®è®¤åï¼Œè¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p>
<pre><code>target(zlib-1.2): static
    [+]: ./adler32.c
    [+]: ./compress.c
    [+]: ./crc32.c
    [+]: ./deflate.c
    [+]: ./gzclose.c
    [+]: ./gzlib.c
    [+]: ./gzread.c
    [+]: ./gzwrite.c
    [+]: ./infback.c
    [+]: ./inffast.c
    [+]: ./inflate.c
    [+]: ./inftrees.c
    [+]: ./trees.c
    [+]: ./uncompr.c
    [+]: ./zutil.c
xmake.lua generated, scan ok!ğŸ‘Œ
checking for the architecture ... x86_64
checking for the Xcode SDK version for macosx ... 10.12
checking for the target minimal version ... 10.12
checking for the c compiler (cc) ... xcrun -sdk macosx clang
checking for the c++ compiler (cxx) ... xcrun -sdk macosx clang
checking for the objc compiler (mm) ... xcrun -sdk macosx clang
checking for the objc++ compiler (mxx) ... xcrun -sdk macosx clang++
checking for the swift compiler (sc) ... xcrun -sdk macosx swiftc
checking for the assember (as) ... xcrun -sdk macosx clang
checking for the linker (ld) ... xcrun -sdk macosx clang++
checking for the static library archiver (ar) ... xcrun -sdk macosx ar
checking for the static library extractor (ex) ... xcrun -sdk macosx ar
checking for the shared library linker (sh) ... xcrun -sdk macosx clang++
checking for the debugger (dd) ... xcrun -sdk macosx lldb
checking for the golang compiler (go) ... go
configure
{
    ex = "xcrun -sdk macosx ar"
,   sh = "xcrun -sdk macosx clang++"
,   host = "macosx"
,   ar = "xcrun -sdk macosx ar"
,   buildir = "build"
,   as = "xcrun -sdk macosx clang"
,   plat = "macosx"
,   xcode_dir = "/Applications/Xcode.app"
,   arch = "x86_64"
,   mxx = "xcrun -sdk macosx clang++"
,   go = "go"
,   target_minver = "10.12"
,   ccache = "ccache"
,   mode = "release"
,   clean = true
,   cxx = "xcrun -sdk macosx clang"
,   cc = "xcrun -sdk macosx clang"
,   dd = "xcrun -sdk macosx lldb"
,   kind = "static"
,   ld = "xcrun -sdk macosx clang++"
,   xcode_sdkver = "10.12"
,   sc = "xcrun -sdk macosx swiftc"
,   mm = "xcrun -sdk macosx clang"
}
configure ok!
clean ok!
[00%]: ccache compiling.release ./adler32.c
[06%]: ccache compiling.release ./compress.c
[13%]: ccache compiling.release ./crc32.c
[20%]: ccache compiling.release ./deflate.c
[26%]: ccache compiling.release ./gzclose.c
[33%]: ccache compiling.release ./gzlib.c
[40%]: ccache compiling.release ./gzread.c
[46%]: ccache compiling.release ./gzwrite.c
[53%]: ccache compiling.release ./infback.c
[60%]: ccache compiling.release ./inffast.c
[66%]: ccache compiling.release ./inflate.c
[73%]: ccache compiling.release ./inftrees.c
[80%]: ccache compiling.release ./trees.c
[86%]: ccache compiling.release ./uncompr.c
[93%]: ccache compiling.release ./zutil.c
[100%]: archiving.release libzlib-1.2.a
build ok!ğŸ‘Œ
</code></pre><p>é€šè¿‡è¾“å‡ºç»“æœï¼Œå¯ä»¥çœ‹åˆ°ï¼Œxmakeä¼šå»æ£€æµ‹æ‰«æå½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰.cä»£ç ï¼Œå‘ç°æ²¡æœ‰mainå…¥å£ï¼Œåº”è¯¥æ˜¯é™æ€åº“ç¨‹åºï¼Œå› æ­¤æ‰§è¡Œxmakeåï¼Œå°±ç›´æ¥ç¼–è¯‘æˆé™æ€åº“libzlib-1.2.aäº†</p>
<p>è¿xmake.luaéƒ½æ²¡æœ‰ç¼–å†™ï¼Œå…¶å®xmakeåœ¨æ‰«æå®Œæˆåï¼Œä¼šå»è‡ªåŠ¨åœ¨å½“å‰ç›®å½•ä¸‹ç”Ÿæˆä¸€ä»½xmake.luaï¼Œä¸‹æ¬¡ç¼–è¯‘å°±ä¸éœ€è¦é‡æ–°æ‰«ææ£€æµ‹äº†ã€‚</p>
<p>è‡ªåŠ¨ç”Ÿæˆçš„xmake.luaå†…å®¹å¦‚ä¸‹ï¼š</p>
<pre><code class="lang-lua">-- define target
target("zlib-1.2")

    -- set kind
    set_kind("static")

    -- add files
    add_files("./adler32.c")
    add_files("./compress.c")
    add_files("./crc32.c")
    add_files("./deflate.c")
    add_files("./gzclose.c")
    add_files("./gzlib.c")
    add_files("./gzread.c")
    add_files("./gzwrite.c")
    add_files("./infback.c")
    add_files("./inffast.c")
    add_files("./inflate.c")
    add_files("./inftrees.c")
    add_files("./trees.c")
    add_files("./uncompr.c")
    add_files("./zutil.c")
</code></pre>
<p>ä¹Ÿè®¸ä½ ä¼šè¯´ï¼Œåƒè¿™ç§å¼€æºåº“ï¼Œç›´æ¥<code>configure; make</code>ä¸å°±å¥½äº†å—ï¼Œä»–ä»¬è‡ªå·±ä¹Ÿæœ‰æä¾›makefileæ¥ç›´æ¥ç¼–è¯‘çš„ï¼Œçš„ç¡®æ˜¯è¿™æ ·ï¼Œæˆ‘è¿™é‡Œåªæ˜¯ä¸¾ä¸ªä¾‹å­è€Œå·²ã€‚ã€‚</p>
<p>å½“ç„¶ï¼Œå¾ˆå¤šå¼€æºåº“åœ¨äº¤å‰ç¼–è¯‘çš„æ—¶å€™ï¼Œé€šè¿‡è‡ªå¸¦çš„<code>configure</code>ï¼Œå¤„ç†èµ·æ¥è¿˜æ˜¯å¾ˆç¹ççš„ï¼Œç”¨xmakeè¿›è¡Œäº¤å‰ç¼–è¯‘ä¼šæ›´æ–¹ä¾¿äº›ã€‚ã€‚</p>
<h3 id="">å³æ—¶åœ°ä»£ç ç¼–å†™å’Œç¼–è¯‘è¿è¡Œ</h3>
<p>xmakeçš„è¿™ä¸ªæ‰«æä»£ç ç¼–è¯‘ç‰¹æ€§ï¼Œä¸»è¦çš„ç›®çš„ï¼šè¿˜æ˜¯ä¸ºäº†è®©æˆ‘ä»¬åœ¨ä¸´æ—¶æƒ³å†™äº›æµ‹è¯•ä»£ç çš„æ—¶å€™ï¼Œä¸ç”¨è€ƒè™‘å¤ªå¤šä¸œè¥¿ï¼Œç›´æ¥ä¸Šæ‰‹æ•²ä»£ç ï¼Œç„¶åå¿«é€Ÿæ‰§è¡Œ<code>xmake run</code> æ¥è°ƒè¯•éªŒè¯ç»“æœã€‚ã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<p>æˆ‘æƒ³å†™äº†ä¸ªç®€å•çš„main.cçš„æµ‹è¯•ç¨‹åºï¼Œæ‰“å°<code>hello world!</code>ï¼Œå¦‚æœè¦å†™makefileæˆ–è€…ç›´æ¥é€šè¿‡gccå‘½ä»¤æ¥ï¼Œå°±å¾ˆç¹çäº†ï¼Œä½ éœ€è¦ï¼š</p>
<pre><code class="lang-bash">gcc ./main.c -o demo
./demo
</code></pre>
<p>æœ€å¿«é€Ÿçš„æ–¹å¼ï¼Œä¹Ÿéœ€è¦æ‰§è¡Œä¸¤è¡Œå‘½ä»¤ï¼Œè€Œå¦‚æœç”¨xmakeï¼Œåªéœ€è¦æ‰§è¡Œï¼š</p>
<pre><code class="lang-bash">xmake run
</code></pre>
<p>å°±è¡Œäº†ï¼Œå®ƒä¼šè‡ªåŠ¨æ£€æµ‹åˆ°ä»£ç åï¼Œè‡ªåŠ¨ç”Ÿæˆå¯¹åº”çš„xmake.luaï¼Œè‡ªåŠ¨ç¼–è¯‘ï¼Œè‡ªåŠ¨è¿è¡Œï¼Œç„¶åè¾“å‡ºï¼š</p>
<pre><code>hello world!
</code></pre><p>å¦‚æœä½ æœ‰åå‡ ä¸ªä»£ç æ–‡ä»¶ï¼Œç”¨æ‰‹æ•²gccçš„æ–¹å¼ï¼Œæˆ–è€…å†™makefileçš„æ–¹å¼ï¼Œè¿™ä¸ªå·®è·å°±æ›´æ˜æ˜¾äº†ï¼Œç”¨xmakeè¿˜æ˜¯åªéœ€è¦ä¸€è¡Œå‘½ä»¤ï¼š</p>
<pre><code class="lang-bash">xmake run
</code></pre>
<h3 id="">å¤šè¯­è¨€æ”¯æŒ</h3>
<p>è¿™ç§ä»£ç æ£€æµ‹å’Œå³æ—¶ç¼–è¯‘ï¼Œæ˜¯æ”¯æŒå¤šè¯­è¨€çš„ï¼Œä¸ä»…æ”¯æŒc/c++ï¼Œè¿˜æ”¯æŒobjc/swiftï¼ŒåæœŸè¿˜ä¼šæ”¯æŒgolangï¼ˆæ­£åœ¨å¼€å‘ä¸­ï¼‰</p>
<p>ä¾‹å¦‚æˆ‘ä¸‹è½½äº†ä¸€ä»½fmdbçš„ioså¼€æºæ¡†æ¶ä»£ç ï¼š</p>
<pre><code>.
â”œâ”€â”€ FMDB.h
â”œâ”€â”€ FMDatabase.h
â”œâ”€â”€ FMDatabase.m
â”œâ”€â”€ FMDatabaseAdditions.h
â”œâ”€â”€ FMDatabaseAdditions.m
â”œâ”€â”€ FMDatabasePool.h
â”œâ”€â”€ FMDatabasePool.m
â”œâ”€â”€ FMDatabaseQueue.h
â”œâ”€â”€ FMDatabaseQueue.m
â”œâ”€â”€ FMResultSet.h
â””â”€â”€ FMResultSet.m
</code></pre><p>æƒ³è¦æŠŠå®ƒç¼–è¯‘æˆiosçš„é™æ€åº“ï¼Œä½†æ˜¯åˆä¸æƒ³å†™xmake.luaï¼Œæˆ–è€…makefileï¼Œé‚£ä¹ˆåªéœ€è¦ä½¿ç”¨xmakeçš„è¿™ä¸ªæ–°ç‰¹æ€§ï¼Œç›´æ¥æ‰§è¡Œï¼š</p>
<pre><code class="lang-bash">$ xmake f -p iphoneos; xmake
</code></pre>
<p>å°±è¡Œäº†ï¼Œè¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p>
<pre><code>xmake.lua not found, scanning files ..
target(FMDB): static
    [+]: ./FMDatabase.m
    [+]: ./FMDatabaseAdditions.m
    [+]: ./FMDatabasePool.m
    [+]: ./FMDatabaseQueue.m
    [+]: ./FMResultSet.m
xmake.lua generated, scan ok!ğŸ‘Œ
checking for the architecture ... armv7
checking for the Xcode SDK version for iphoneos ... 10.1
checking for the target minimal version ... 10.1
checking for the c compiler (cc) ... xcrun -sdk iphoneos clang
checking for the c++ compiler (cxx) ... xcrun -sdk iphoneos clang
checking for the objc compiler (mm) ... xcrun -sdk iphoneos clang
checking for the objc++ compiler (mxx) ... xcrun -sdk iphoneos clang++
checking for the assember (as) ... gas-preprocessor.pl xcrun -sdk iphoneos clang
checking for the linker (ld) ... xcrun -sdk iphoneos clang++
checking for the static library archiver (ar) ... xcrun -sdk iphoneos ar
checking for the static library extractor (ex) ... xcrun -sdk iphoneos ar
checking for the shared library linker (sh) ... xcrun -sdk iphoneos clang++
checking for the swift compiler (sc) ... xcrun -sdk iphoneos swiftc
configure
{
    ex = "xcrun -sdk iphoneos ar"
,   ccache = "ccache"
,   host = "macosx"
,   ar = "xcrun -sdk iphoneos ar"
,   buildir = "build"
,   as = "/usr/local/share/xmake/tools/utils/gas-preprocessor.pl xcrun -sdk iphoneos clang"
,   arch = "armv7"
,   mxx = "xcrun -sdk iphoneos clang++"
,   cxx = "xcrun -sdk iphoneos clang"
,   target_minver = "10.1"
,   xcode_dir = "/Applications/Xcode.app"
,   clean = true
,   sh = "xcrun -sdk iphoneos clang++"
,   cc = "xcrun -sdk iphoneos clang"
,   ld = "xcrun -sdk iphoneos clang++"
,   mode = "release"
,   kind = "static"
,   plat = "iphoneos"
,   xcode_sdkver = "10.1"
,   sc = "xcrun -sdk iphoneos swiftc"
,   mm = "xcrun -sdk iphoneos clang"
}
configure ok!
clean ok!
[00%]: ccache compiling.release ./FMDatabase.m
[20%]: ccache compiling.release ./FMDatabaseAdditions.m
[40%]: ccache compiling.release ./FMDatabasePool.m
[60%]: ccache compiling.release ./FMDatabaseQueue.m
[80%]: ccache compiling.release ./FMResultSet.m
[100%]: archiving.release libFMDB.a
build ok!ğŸ‘Œ
</code></pre><h3 id="">åŒæ—¶ç¼–è¯‘å¤šä¸ªå¯æ‰§è¡Œæ–‡ä»¶</h3>
<p>è¾“å‡ºç»“æœçš„å¼€å¤´éƒ¨åˆ†ï¼Œå°±æ˜¯å¯¹ä»£ç çš„åˆ†æç»“æœï¼Œè™½ç„¶ç›®å‰åªæ”¯æŒå•çº§ç›®å½•ç»“æ„çš„ä»£ç æ‰«æï¼Œä½†æ˜¯è¿˜æ˜¯å¯ä»¥åŒæ—¶æ”¯æŒæ£€æµ‹å’Œç¼–è¯‘å¤šä¸ªå¯æ‰§è¡Œæ–‡ä»¶çš„</p>
<p>æˆ‘ä»¬ä»¥libjpegçš„å¼€æºåº“ä¸ºä¾‹ï¼š</p>
<p>æˆ‘ä»¬è¿›å…¥jpeg-6bç›®å½•åï¼Œæ‰§è¡Œï¼š</p>
<pre><code class="lang-bash">$ xmake
</code></pre>
<p>è¾“å‡ºå¦‚ä¸‹ï¼š</p>
<pre><code>xmake.lua not found, scanning files ..
target(jpeg-6b): static
    [+]: ./cdjpeg.c
    [+]: ./example.c
    [+]: ./jcapimin.c
    [+]: ./jcapistd.c
    [+]: ./jccoefct.c
    [+]: ./jccolor.c
    [+]: ./jcdctmgr.c
    [+]: ./jchuff.c
    [+]: ./jcinit.c
    [+]: ./jcmainct.c
    [+]: ./jcmarker.c
    [+]: ./jcmaster.c
    [+]: ./jcomapi.c
    [+]: ./jcparam.c
    [+]: ./jcphuff.c
    [+]: ./jcprepct.c
    [+]: ./jcsample.c
    [+]: ./jctrans.c
    [+]: ./jdapimin.c
    [+]: ./jdapistd.c
    [+]: ./jdatadst.c
    [+]: ./jdatasrc.c
    [+]: ./jdcoefct.c
    [+]: ./jdcolor.c
    [+]: ./jddctmgr.c
    [+]: ./jdhuff.c
    [+]: ./jdinput.c
    [+]: ./jdmainct.c
    [+]: ./jdmarker.c
    [+]: ./jdmaster.c
    [+]: ./jdmerge.c
    [+]: ./jdphuff.c
    [+]: ./jdpostct.c
    [+]: ./jdsample.c
    [+]: ./jdtrans.c
    [+]: ./jerror.c
    [+]: ./jfdctflt.c
    [+]: ./jfdctfst.c
    [+]: ./jfdctint.c
    [+]: ./jidctflt.c
    [+]: ./jidctfst.c
    [+]: ./jidctint.c
    [+]: ./jidctred.c
    [+]: ./jmemansi.c
    [+]: ./jmemmgr.c
    [+]: ./jmemname.c
    [+]: ./jmemnobs.c
    [+]: ./jquant1.c
    [+]: ./jquant2.c
    [+]: ./jutils.c
    [+]: ./rdbmp.c
    [+]: ./rdcolmap.c
    [+]: ./rdgif.c
    [+]: ./rdppm.c
    [+]: ./rdrle.c
    [+]: ./rdswitch.c
    [+]: ./rdtarga.c
    [+]: ./transupp.c
    [+]: ./wrbmp.c
    [+]: ./wrgif.c
    [+]: ./wrppm.c
    [+]: ./wrrle.c
    [+]: ./wrtarga.c
target(ansi2knr): binary
    [+]: ./ansi2knr.c
target(cjpeg): binary
    [+]: ./cjpeg.c
target(ckconfig): binary
    [+]: ./ckconfig.c
target(djpeg): binary
    [+]: ./djpeg.c
target(jpegtran): binary
    [+]: ./jpegtran.c
target(rdjpgcom): binary
    [+]: ./rdjpgcom.c
target(wrjpgcom): binary
    [+]: ./wrjpgcom.c
xmake.lua generated, scan ok!ğŸ‘Œ
checking for the architecture ... x86_64
checking for the Xcode SDK version for macosx ... 10.12
checking for the target minimal version ... 10.12
checking for the c compiler (cc) ... xcrun -sdk macosx clang
checking for the c++ compiler (cxx) ... xcrun -sdk macosx clang
checking for the objc compiler (mm) ... xcrun -sdk macosx clang
checking for the objc++ compiler (mxx) ... xcrun -sdk macosx clang++
checking for the swift compiler (sc) ... xcrun -sdk macosx swiftc
checking for the assember (as) ... xcrun -sdk macosx clang
checking for the linker (ld) ... xcrun -sdk macosx clang++
checking for the static library archiver (ar) ... xcrun -sdk macosx ar
checking for the static library extractor (ex) ... xcrun -sdk macosx ar
checking for the shared library linker (sh) ... xcrun -sdk macosx clang++
checking for the debugger (dd) ... xcrun -sdk macosx lldb
checking for the golang compiler (go) ... go
configure
{
    ex = "xcrun -sdk macosx ar"
,   sh = "xcrun -sdk macosx clang++"
,   host = "macosx"
,   ar = "xcrun -sdk macosx ar"
,   buildir = "build"
,   as = "xcrun -sdk macosx clang"
,   plat = "macosx"
,   xcode_dir = "/Applications/Xcode.app"
,   arch = "x86_64"
,   mxx = "xcrun -sdk macosx clang++"
,   go = "go"
,   target_minver = "10.12"
,   ccache = "ccache"
,   mode = "release"
,   clean = true
,   cxx = "xcrun -sdk macosx clang"
,   cc = "xcrun -sdk macosx clang"
,   dd = "xcrun -sdk macosx lldb"
,   kind = "static"
,   ld = "xcrun -sdk macosx clang++"
,   xcode_sdkver = "10.12"
,   sc = "xcrun -sdk macosx swiftc"
,   mm = "xcrun -sdk macosx clang"
}
configure ok!
clean ok!
[00%]: ccache compiling.release ./cdjpeg.c
[00%]: ccache compiling.release ./example.c
[00%]: ccache compiling.release ./jcapimin.c
[00%]: ccache compiling.release ./jcapistd.c
[00%]: ccache compiling.release ./jccoefct.c
[00%]: ccache compiling.release ./jccolor.c
[01%]: ccache compiling.release ./jcdctmgr.c
[01%]: ccache compiling.release ./jchuff.c
[01%]: ccache compiling.release ./jcinit.c
[01%]: ccache compiling.release ./jcmainct.c
[01%]: ccache compiling.release ./jcmarker.c
[02%]: ccache compiling.release ./jcmaster.c
[02%]: ccache compiling.release ./jcomapi.c
[02%]: ccache compiling.release ./jcparam.c
[02%]: ccache compiling.release ./jcphuff.c
[02%]: ccache compiling.release ./jcprepct.c
[03%]: ccache compiling.release ./jcsample.c
[03%]: ccache compiling.release ./jctrans.c
[03%]: ccache compiling.release ./jdapimin.c
[03%]: ccache compiling.release ./jdapistd.c
[03%]: ccache compiling.release ./jdatadst.c
[04%]: ccache compiling.release ./jdatasrc.c
[04%]: ccache compiling.release ./jdcoefct.c
[04%]: ccache compiling.release ./jdcolor.c
[04%]: ccache compiling.release ./jddctmgr.c
[04%]: ccache compiling.release ./jdhuff.c
[05%]: ccache compiling.release ./jdinput.c
[05%]: ccache compiling.release ./jdmainct.c
[05%]: ccache compiling.release ./jdmarker.c
[05%]: ccache compiling.release ./jdmaster.c
[05%]: ccache compiling.release ./jdmerge.c
[06%]: ccache compiling.release ./jdphuff.c
[06%]: ccache compiling.release ./jdpostct.c
[06%]: ccache compiling.release ./jdsample.c
[06%]: ccache compiling.release ./jdtrans.c
[06%]: ccache compiling.release ./jerror.c
[07%]: ccache compiling.release ./jfdctflt.c
[07%]: ccache compiling.release ./jfdctfst.c
[07%]: ccache compiling.release ./jfdctint.c
[07%]: ccache compiling.release ./jidctflt.c
[07%]: ccache compiling.release ./jidctfst.c
[08%]: ccache compiling.release ./jidctint.c
[08%]: ccache compiling.release ./jidctred.c
[08%]: ccache compiling.release ./jmemansi.c
[08%]: ccache compiling.release ./jmemmgr.c
[08%]: ccache compiling.release ./jmemname.c
[09%]: ccache compiling.release ./jmemnobs.c
[09%]: ccache compiling.release ./jquant1.c
[09%]: ccache compiling.release ./jquant2.c
[09%]: ccache compiling.release ./jutils.c
[09%]: ccache compiling.release ./rdbmp.c
[10%]: ccache compiling.release ./rdcolmap.c
[10%]: ccache compiling.release ./rdgif.c
[10%]: ccache compiling.release ./rdppm.c
[10%]: ccache compiling.release ./rdrle.c
[10%]: ccache compiling.release ./rdswitch.c
[11%]: ccache compiling.release ./rdtarga.c
[11%]: ccache compiling.release ./transupp.c
[11%]: ccache compiling.release ./wrbmp.c
[11%]: ccache compiling.release ./wrgif.c
[11%]: ccache compiling.release ./wrppm.c
[12%]: ccache compiling.release ./wrrle.c
[12%]: ccache compiling.release ./wrtarga.c
[12%]: archiving.release libjpeg-6b.a
[12%]: ccache compiling.release ./wrjpgcom.c
[25%]: linking.release wrjpgcom
[25%]: ccache compiling.release ./ansi2knr.c
[37%]: linking.release ansi2knr
[37%]: ccache compiling.release ./jpegtran.c
[50%]: linking.release jpegtran
[50%]: ccache compiling.release ./djpeg.c
[62%]: linking.release djpeg
[62%]: ccache compiling.release ./ckconfig.c
[75%]: linking.release ckconfig
[75%]: ccache compiling.release ./rdjpgcom.c
[87%]: linking.release rdjpgcom
[87%]: ccache compiling.release ./cjpeg.c
[100%]: linking.release cjpeg
build ok!ğŸ‘Œ
</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œå¤„ç†é™æ€åº“ï¼Œxmakeè¿˜åˆ†æå‡ºäº†å¾ˆå¤šå¯æ‰§è¡Œçš„æµ‹è¯•ç¨‹åºï¼Œå‰©ä¸‹çš„ä»£ç ç»Ÿä¸€ç¼–è¯‘æˆä¸€ä¸ª libjpeg.a çš„é™æ€åº“ï¼Œä¾›å“ªäº›æµ‹è¯•ç¨‹åºé“¾æ¥ä½¿ç”¨ã€‚ã€‚</p>
<pre><code>target(ansi2knr): binary
    [+]: ./ansi2knr.c
target(cjpeg): binary
    [+]: ./cjpeg.c
target(ckconfig): binary
    [+]: ./ckconfig.c
target(djpeg): binary
    [+]: ./djpeg.c
target(jpegtran): binary
    [+]: ./jpegtran.c
target(rdjpgcom): binary
    [+]: ./rdjpgcom.c
target(wrjpgcom): binary
    [+]: ./wrjpgcom.c
</code></pre><h3 id="">é‡åˆ°çš„ä¸€äº›é—®é¢˜å’Œé™åˆ¶</h3>
<p>å½“å‰xmakeçš„è¿™ç§è‡ªåŠ¨åˆ†ææ£€æµ‹è¿˜ä¸æ˜¯éå¸¸æ™ºèƒ½ï¼Œå¯¹äºï¼š</p>
<ol>
<li>éœ€è¦ç‰¹æ®Šçš„ç¼–è¯‘é€‰é¡¹</li>
<li>éœ€è¦ä¾èµ–å…¶ä»–ç›®å½•çš„å¤´æ–‡ä»¶æœç´¢</li>
<li>éœ€è¦åˆ†æ¡ä»¶ç¼–è¯‘ä¸åŒæºæ–‡ä»¶</li>
<li>åŒç›®å½•éœ€è¦ç”Ÿæˆå¤šä¸ªé™æ€åº“</li>
<li>éœ€è¦å¤šçº§ç›®å½•æ”¯æŒçš„æºç åº“</li>
</ol>
<p>ä»¥ä¸Šè¿™äº›æƒ…å†µï¼Œxmakeæš‚æ—¶è¿˜æ²¡å‘è‡ªåŠ¨åŒ–çš„æ™ºèƒ½å¤„ç†ï¼Œå…¶ä¸­é™åˆ¶1ï¼Œ2è¿˜æ˜¯å¯ä»¥è§£å†³çš„ï¼Œé€šè¿‡åŠæ‰‹åŠ¨çš„æ–¹å¼ï¼Œä¾‹å¦‚ï¼š</p>
<pre><code class="lang-bash">$ xmake f --cxflags="" --ldflags="" --includedirs="" --linkdirs=""; xmake
</code></pre>
<p>åœ¨è‡ªåŠ¨æ£€æµ‹ç¼–è¯‘çš„æ—¶å€™ï¼Œæ‰‹åŠ¨é…ç½®è¿™ä¸ªæºç å·¥ç¨‹éœ€è¦çš„ç‰¹æ®Šç¼–è¯‘é€‰é¡¹ï¼Œå°±å¯ä»¥ç›´æ¥é€šè¿‡ç¼–è¯‘äº†</p>
<p>è€Œé™åˆ¶3ï¼Œæš‚æ—¶åªèƒ½é€šè¿‡åˆ æºä»£ç æ¥è§£å†³äº†ï¼Œå°±åƒåˆšæ‰ç¼–è¯‘jpegçš„ä»£ç ï¼Œå…¶å®å®ƒçš„ç›®å½•ä¸‹é¢åŒæ—¶å­˜åœ¨äº†ï¼š</p>
<pre><code>jmemdos.c
jmemmac.c
jmemansi.c
</code></pre><p>å…¶ä¸­ä¸¤ä¸ªæ˜¯æ²¡æ³•ç¼–è¯‘è¿‡çš„ï¼Œéœ€è¦åˆ æ‰åæ‰è¡Œã€‚ã€‚</p>
<h2 id="unitybuild">Unity Build ç¼–è¯‘åŠ é€Ÿ</h2>
<p>æˆ‘ä»¬çŸ¥é“ï¼ŒC++ ä»£ç ç¼–è¯‘é€Ÿåº¦é€šå¸¸å¾ˆæ…¢ï¼Œå› ä¸ºæ¯ä¸ªä»£ç æ–‡ä»¶éƒ½éœ€è¦è§£æå¼•å…¥çš„å¤´æ–‡ä»¶ã€‚</p>
<p>è€Œé€šè¿‡ Unity Buildï¼Œæˆ‘ä»¬é€šè¿‡å°†å¤šä¸ª cpp æ–‡ä»¶ç»„åˆæˆä¸€ä¸ªæ¥åŠ é€Ÿé¡¹ç›®çš„ç¼–è¯‘ï¼Œå…¶ä¸»è¦å¥½å¤„æ˜¯å‡å°‘äº†è§£æå’Œç¼–è¯‘åŒ…å«åœ¨å¤šä¸ªæºæ–‡ä»¶ä¸­çš„å¤´æ–‡ä»¶å†…å®¹çš„é‡å¤å·¥ä½œï¼Œå¤´æ–‡ä»¶çš„å†…å®¹é€šå¸¸å é¢„å¤„ç†åæºæ–‡ä»¶ä¸­çš„å¤§éƒ¨åˆ†ä»£ç ã€‚</p>
<p>Unity æ„å»ºè¿˜é€šè¿‡å‡å°‘ç¼–è¯‘é“¾åˆ›å»ºå’Œå¤„ç†çš„ç›®æ ‡æ–‡ä»¶çš„æ•°é‡æ¥å‡è½»ç”±äºæ‹¥æœ‰å¤§é‡å°æºæ–‡ä»¶è€Œå¯¼è‡´çš„å¼€é”€ï¼Œå¹¶å…è®¸è·¨å½¢æˆç»Ÿä¸€æ„å»ºä»»åŠ¡çš„æ–‡ä»¶è¿›è¡Œè¿‡ç¨‹é—´åˆ†æå’Œä¼˜åŒ–ï¼ˆç±»ä¼¼äºæ•ˆæœé“¾æ¥æ—¶ä¼˜åŒ–ï¼‰ã€‚</p>
<p>å®ƒå¯ä»¥æå¤§æå‡ C/C++ ä»£ç çš„ç¼–è¯‘é€Ÿåº¦ï¼Œé€šå¸¸ä¼šæœ‰ 30% çš„é€Ÿåº¦æå‡ï¼Œä¸è¿‡æ ¹æ®é¡¹ç›®çš„å¤æ‚ç¨‹åº¦ä¸åŒï¼Œå…¶å¸¦æ¥çš„æ•ˆç›Šè¿˜æ˜¯è¦æ ¹æ®è‡ªèº«é¡¹ç›®æƒ…å†µè€Œå®šã€‚</p>
<p>xmake åœ¨ v2.5.9 ç‰ˆæœ¬ä¸­ï¼Œä¹Ÿå·²ç»æ”¯æŒäº†è¿™ç§æ„å»ºæ¨¡å¼ã€‚ç›¸å…³ issues è§ <a href="https://github.com/xmake-io/xmake/issues/1019">#1019</a>ã€‚</p>
<h3 id="">å¦‚ä½•å¯ç”¨ï¼Ÿ</h3>
<p>æˆ‘ä»¬æä¾›äº†ä¸¤ä¸ªå†…ç½®è§„åˆ™ï¼Œåˆ†åˆ«å¤„ç†å¯¹ C å’Œ C++ ä»£ç çš„ Unity Buildã€‚</p>
<pre><code class="lang-lua">add_rules("c.unity_build")
add_rules("c++.unity_build")
</code></pre>
<h3 id="batch">Batch æ¨¡å¼</h3>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œåªè¦è®¾ç½®ä¸Šè¿°è§„åˆ™ï¼Œå°±ä¼šå¯ç”¨ Batch æ¨¡å¼çš„ Unity Buildï¼Œä¹Ÿå°±æ˜¯ xmake è‡ªåŠ¨æ ¹æ®é¡¹ç›®ä»£ç æ–‡ä»¶ï¼Œè‡ªåŠ¨ç»„ç»‡åˆå¹¶ã€‚</p>
<pre><code class="lang-lua">target("test")
    set_kind("binary")
    add_includedirs("src")
    add_rules("c++.unity_build", {batchsize = 2})
    add_files("src/*.c", "src/*.cpp")
</code></pre>
<p>æˆ‘ä»¬å¯ä»¥é¢å¤–é€šè¿‡è®¾ç½® <code>{batchsize = 2}</code> å‚æ•°åˆ°è§„åˆ™ï¼Œæ¥æŒ‡å®šæ¯ä¸ªåˆå¹¶ Batch çš„å¤§å°æ•°é‡ï¼Œè¿™é‡Œä¹Ÿå°±æ˜¯æ¯ä¸¤ä¸ª C++ æ–‡ä»¶è‡ªåŠ¨åˆå¹¶ç¼–è¯‘ã€‚</p>
<p>ç¼–è¯‘æ•ˆæœå¤§æ¦‚å¦‚ä¸‹ï¼š</p>
<pre><code class="lang-console">$ xmake -r
[ 11%]: ccache compiling.release build/.gens/test/unity_build/unity_642A245F.cpp
[ 11%]: ccache compiling.release build/.gens/test/unity_build/unity_bar.cpp
[ 11%]: ccache compiling.release build/.gens/test/unity_build/unity_73161A20.cpp
[ 11%]: ccache compiling.release build/.gens/test/unity_build/unity_F905F036.cpp
[ 11%]: ccache compiling.release build/.gens/test/unity_build/unity_foo.cpp
[ 11%]: ccache compiling.release build/.gens/test/unity_build/main.c
[ 77%]: linking.release test
[100%]: build ok
</code></pre>
<p>ç”±äºæˆ‘ä»¬ä»…ä»…å¯ç”¨äº† C++ çš„ Unity Buildï¼Œæ‰€ä»¥ C ä»£ç è¿˜æ˜¯æ­£å¸¸æŒ¨ä¸ªç¼–è¯‘ã€‚å¦å¤–åœ¨ Unity Build æ¨¡å¼ä¸‹ï¼Œæˆ‘ä»¬è¿˜æ˜¯å¯ä»¥åšåˆ°å°½å¯èƒ½çš„å¹¶è¡Œç¼–è¯‘åŠ é€Ÿï¼Œäº’ä¸å†²çªã€‚</p>
<p>å¦‚æœæ²¡æœ‰è®¾ç½® <code>batchsize</code> å‚æ•°ï¼Œé‚£ä¹ˆé»˜è®¤ä¼šå§æ‰€æœ‰æ–‡ä»¶åˆå¹¶åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­è¿›è¡Œç¼–è¯‘ã€‚</p>
<h3 id="group">Group æ¨¡å¼</h3>
<p>å¦‚æœä¸Šé¢çš„ Batch æ¨¡å¼è‡ªåŠ¨åˆå¹¶æ•ˆæœä¸ç†æƒ³ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰åˆ†ç»„ï¼Œæ¥æ‰‹åŠ¨é…ç½®å“ªäº›æ–‡ä»¶åˆå¹¶åˆ°ä¸€èµ·å‚ä¸ç¼–è¯‘ï¼Œè¿™ä½¿å¾—ç”¨æˆ·æ›´åŠ åœ°çµæ´»å¯æ§ã€‚</p>
<pre><code class="lang-lua">target("test")
    set_kind("binary")
    add_rules("c++.unity_build", {batchsize = 0}) -- disable batch mode
    add_files("src/*.c", "src/*.cpp")
    add_files("src/foo/*.c", {unity_group = "foo"})
    add_files("src/bar/*.c", {unity_group = "bar"})
</code></pre>
<p>æˆ‘ä»¬ä½¿ç”¨ <code>{unity_group = "foo"}</code> æ¥æŒ‡å®šæ¯ä¸ªåˆ†ç»„çš„åå­—ï¼Œä»¥åŠåŒ…å«äº†å“ªäº›æ–‡ä»¶ï¼Œæ¯ä¸ªåˆ†ç»„çš„æ–‡ä»¶éƒ½ä¼šå•ç‹¬è¢«åˆå¹¶åˆ°ä¸€ä¸ªä»£ç æ–‡ä»¶ä¸­å»ã€‚</p>
<p>å¦å¤–ï¼Œ<code>batchsize = 0</code> ä¹Ÿå¼ºè¡Œç¦ç”¨äº† Batch æ¨¡å¼ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ²¡æœ‰è®¾ç½® unity_group åˆ†ç»„çš„ä»£ç æ–‡ä»¶ï¼Œæˆ‘ä»¬è¿˜æ˜¯ä¼šå•ç‹¬ç¼–è¯‘å®ƒä»¬ï¼Œä¹Ÿä¸ä¼šè‡ªåŠ¨å¼€å¯è‡ªåŠ¨åˆå¹¶ã€‚</p>
<h3 id="batchgroup">Batch å’Œ Group æ··åˆæ¨¡å¼</h3>
<p>æˆ‘ä»¬åªè¦æŠŠä¸Šé¢çš„ <code>batchsize = 0</code> æ”¹æˆé 0 å€¼ï¼Œå°±å¯ä»¥è®©åˆ†ç»„æ¨¡å¼ä¸‹ï¼Œå‰©ä½™çš„ä»£ç æ–‡ä»¶ç»§ç»­å¼€å¯ Batch æ¨¡å¼è‡ªåŠ¨åˆå¹¶ç¼–è¯‘ã€‚</p>
<pre><code class="lang-lua">target("test")
    set_kind("binary")
    add_includedirs("src")
    add_rules("c++.unity_build", {batchsize = 2})
    add_files("src/*.c", "src/*.cpp")
    add_files("src/foo/*.c", {unity_group = "foo"})
    add_files("src/bar/*.c", {unity_group = "bar"})
</code></pre>
<h3 id="">å¿½ç•¥æŒ‡å®šæ–‡ä»¶</h3>
<p>å¦‚æœæ˜¯ Batch æ¨¡å¼ä¸‹ï¼Œç”±äºæ˜¯è‡ªåŠ¨åˆå¹¶æ“ä½œï¼Œæ‰€ä»¥é»˜è®¤ä¼šå¯¹æ‰€æœ‰æ–‡ä»¶æ‰§è¡Œåˆå¹¶ï¼Œä½†å¦‚æœæœ‰äº›ä»£ç æ–‡ä»¶æˆ‘ä»¬ä¸æƒ³è®©å®ƒå‚ä¸åˆå¹¶ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ <code>{unity_ignored = true}</code> å»å¿½ç•¥å®ƒä»¬ã€‚</p>
<pre><code class="lang-lua">target("test")
    set_kind("binary")
    add_includedirs("src")
    add_rules("c++.unity_build", {batchsize = 2})
    add_files("src/*.c", "src/*.cpp")
    add_files("src/test/*.c", {unity_ignored = true}) -- ignore these files
</code></pre>
<h3 id="uniqueid">Unique ID</h3>
<p>å°½ç®¡ Unity Build å¸¦å•¦çš„æ”¶ç›Šä¸é”™ï¼Œä½†æ˜¯æˆ‘ä»¬è¿˜æ˜¯ä¼šé‡åˆ°ä¸€äº›æ„å¤–çš„æƒ…å†µï¼Œæ¯”å¦‚æˆ‘ä»¬çš„ä¸¤ä¸ªä»£ç æ–‡ä»¶é‡Œé¢ï¼Œå…¨å±€å‘½åç©ºé—´ä¸‹ï¼Œéƒ½å­˜åœ¨ç›¸åŒåå­—çš„å…¨å±€å˜é‡å’Œå‡½æ•°ã€‚</p>
<p>é‚£ä¹ˆï¼Œåˆå¹¶ç¼–è¯‘å°±ä¼šå¸¦æ¥ç¼–è¯‘å†²çªé—®é¢˜ï¼Œç¼–è¯‘å™¨é€šå¸¸ä¼šæŠ¥å…¨å±€å˜é‡é‡å®šä¹‰é”™è¯¯ã€‚</p>
<p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦ç”¨æˆ·ä»£ç ä¸Šåšä¸€äº›ä¿®æ”¹ï¼Œç„¶åé…åˆæ„å»ºå·¥å…·æ¥è§£å†³ã€‚</p>
<p>æ¯”å¦‚ï¼Œæˆ‘ä»¬çš„ foo.cpp å’Œ bar.cpp éƒ½æœ‰å…¨å±€å˜é‡ iã€‚</p>
<p>foo.cpp</p>
<pre><code class="lang-c">namespace {
    int i = 42;
}

int foo()
{
    return i;
}
</code></pre>
<p>bar.cpp</p>
<pre><code class="lang-c">namespace {
    int i = 42;
}

int bar()
{
    return i;
}
</code></pre>
<p>é‚£ä¹ˆï¼Œæˆ‘ä»¬åˆå¹¶ç¼–è¯‘å°±ä¼šå†²çªï¼Œæˆ‘ä»¬å¯ä»¥å¼•å…¥ä¸€ä¸ª Unique ID æ¥éš”ç¦»å…¨å±€çš„åŒ¿åç©ºé—´ã€‚</p>
<p>foo.cpp</p>
<pre><code class="lang-c">namespace MY_UNITY_ID {
    int i = 42;
}

int foo()
{
    return MY_UNITY_ID::i;
}
</code></pre>
<p>bar.cpp</p>
<pre><code class="lang-c">namespace MY_UNITY_ID {
    int i = 42;
}

int bar()
{
    return MY_UNITY_ID::i;
}
</code></pre>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è¿˜éœ€è¦ä¿è¯ä»£ç åˆå¹¶åï¼Œ <code>MY_UNITY_ID</code> åœ¨ foo å’Œ bar ä¸­çš„å®šä¹‰å®Œå…¨ä¸åŒï¼Œå¯ä»¥æŒ‰æ–‡ä»¶åç®—ä¸€ä¸ªå”¯ä¸€ ID å€¼å‡ºæ¥ï¼Œäº’ä¸å†²çªï¼Œä¹Ÿå°±æ˜¯å®ç°ä¸‹é¢çš„åˆå¹¶æ•ˆæœï¼š</p>
<pre><code class="lang-c">#define MY_UNITY_ID <hash(foo.cpp)>
#include "foo.c"
#undef MY_UNITY_ID
#define MY_UNITY_ID <hash(bar.cpp)>
#include "bar.c"
#undef MY_UNITY_ID
</code></pre>
<p>è¿™çœ‹ä¸Šå»ä¼¼ä¹å¾ˆéº»çƒ¦ï¼Œä½†æ˜¯ç”¨æˆ·ä¸éœ€è¦å…³å¿ƒè¿™äº›ï¼Œxmake ä¼šåœ¨åˆå¹¶æ—¶å€™è‡ªåŠ¨å¤„ç†å®ƒä»¬ï¼Œç”¨æˆ·åªéœ€è¦æŒ‡å®šè¿™ä¸ª Unique ID çš„åå­—å°±è¡Œäº†ï¼Œä¾‹å¦‚ä¸‹é¢è¿™æ ·ï¼š</p>
<pre><code class="lang-lua">target("test")
    set_kind("binary")
    add_includedirs("src")
    add_rules("c++.unity_build", {batchsize = 2, uniqueid = "MY_UNITY_ID"})
    add_files("src/*.c", "src/*.cpp")
</code></pre>
<p>å¤„ç†å…¨å±€å˜é‡ï¼Œè¿˜æœ‰å…¨å±€çš„é‡åå®å®šä¹‰ï¼Œå‡½æ•°ä»€ä¹ˆçš„ï¼Œéƒ½å¯ä»¥é‡‡ç”¨è¿™ç§æ–¹å¼æ¥é¿å…å†²çªã€‚</p>
<h2 id="">è¿œç¨‹ç¼–è¯‘</h2>
<p>2.6.5 ç‰ˆæœ¬æä¾›äº†è¿œç¨‹ç¼–è¯‘æ”¯æŒï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å®ƒå¯ä»¥è¿œç¨‹æœåŠ¡å™¨ä¸Šç¼–è¯‘ä»£ç ï¼Œè¿œç¨‹è¿è¡Œå’Œè°ƒè¯•ã€‚</p>
<p>æœåŠ¡å™¨å¯ä»¥éƒ¨ç½²åœ¨ Linux/MacOS/Windows ä¸Šï¼Œå®ç°è·¨å¹³å°ç¼–è¯‘ï¼Œä¾‹å¦‚ï¼šåœ¨ Linux ä¸Šç¼–è¯‘è¿è¡Œ Windows ç¨‹åºï¼Œåœ¨ Windows ä¸Šç¼–è¯‘è¿è¡Œ macOS/Linux ç¨‹åºã€‚</p>
<p>ç›¸æ¯” ssh è¿œç¨‹ç™»å…¥ç¼–è¯‘ï¼Œå®ƒæ›´åŠ çš„ç¨³å®šï¼Œä½¿ç”¨æ›´åŠ æµç•…ï¼Œä¸ä¼šå› ä¸ºç½‘ç»œä¸ç¨³å®šå¯¼è‡´ ssh ç»ˆç«¯è¾“å…¥å¡é¡¿ï¼Œä¹Ÿå¯ä»¥å®ç°æœ¬åœ°å¿«é€Ÿç¼–è¾‘ä»£ç æ–‡ä»¶ã€‚</p>
<p>ç”šè‡³æˆ‘ä»¬å¯ä»¥åœ¨ vs/sublime/vscode/idea ç­‰ç¼–è¾‘å™¨å’ŒIDE ä¸­æ— ç¼å®ç°è¿œç¨‹ç¼–è¯‘ï¼Œè€Œä¸éœ€è¦ä¾èµ– IDE æœ¬èº«å¯¹è¿œç¨‹ç¼–è¯‘çš„æ”¯æŒåŠ›åº¦ã€‚</p>
<h3 id="">å¼€å¯æœåŠ¡</h3>
<pre><code class="lang-console">$ xmake service
<remote_build_server>: listening 0.0.0.0:9091 ..
</code></pre>
<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥å¼€å¯æœåŠ¡çš„åŒæ—¶ï¼Œå›æ˜¾è¯¦ç»†æ—¥å¿—ä¿¡æ¯ã€‚</p>
<pre><code class="lang-console">$ xmake service -vD
<remote_build_server>: listening 0.0.0.0:9091 ..
</code></pre>
<h3 id="daemon">ä»¥ Daemon æ¨¡å¼å¼€å¯æœåŠ¡</h3>
<pre><code class="lang-console">$ xmake service --start
$ xmake service --restart
$ xmake service --stop
</code></pre>
<h3 id="">é…ç½®æœåŠ¡ç«¯</h3>
<p>æˆ‘ä»¬é¦–å…ˆï¼Œè¿è¡Œ <code>xmake service</code> å‘½ä»¤ï¼Œå®ƒä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªé»˜è®¤çš„ <code>server.conf</code> é…ç½®æ–‡ä»¶ï¼Œå­˜å‚¨åˆ° <code>~/.xmake/service/server.conf</code>ã€‚</p>
<p>!> 2.6.5 ç‰ˆæœ¬ï¼Œé…ç½®åœ°å€åœ¨ <code>~/.xmake/service.conf</code>ï¼Œåç»­ç‰ˆæœ¬åšäº†å¤§é‡æ”¹è¿›ï¼Œåˆ†ç¦»äº†é…ç½®æ–‡ä»¶ï¼Œå¦‚æœç”¨çš„æ˜¯ 2.6.6 ä»¥ä¸Šç‰ˆæœ¬ï¼Œè¯·ä½¿ç”¨æ–°çš„é…ç½®æ–‡ä»¶ã€‚</p>
<p>ç„¶åï¼Œæˆ‘ä»¬ç¼–è¾‘å®ƒï¼Œä¿®å¤æœåŠ¡å™¨çš„ç›‘å¬ç«¯å£ï¼ˆå¯é€‰ï¼‰ã€‚</p>
<pre><code class="lang-bash">$ cat ~/.xmake/service/server.conf
{
    known_hosts = { },
    logfile = "/Users/ruki/.xmake/service/server/logs.txt",
    remote_build = {
        listen = "0.0.0.0:9691",
        workdir = "/Users/ruki/.xmake/service/server/remote_build"
    },
    tokens = {
        "e438d816c95958667747c318f1532c0f"
    }
}
</code></pre>
<h3 id="">é…ç½®å®¢æˆ·ç«¯</h3>
<p>å®¢æˆ·ç«¯é…ç½®æ–‡ä»¶åœ¨ <code>~/.xmake/service/client.conf</code>ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨é‡Œé¢é…ç½®å®¢æˆ·ç«¯éœ€è¦è¿æ¥çš„æœåŠ¡å™¨åœ°å€ã€‚</p>
<p>!> 2.6.5 ç‰ˆæœ¬ï¼Œé…ç½®åœ°å€åœ¨ <code>~/.xmake/service.conf</code>ï¼Œåç»­ç‰ˆæœ¬åšäº†å¤§é‡æ”¹è¿›ï¼Œåˆ†ç¦»äº†é…ç½®æ–‡ä»¶ï¼Œå¦‚æœç”¨çš„æ˜¯ 2.6.6 ä»¥ä¸Šç‰ˆæœ¬ï¼Œè¯·ä½¿ç”¨æ–°çš„é…ç½®æ–‡ä»¶ã€‚</p>
<pre><code class="lang-console">$ cat ~/.xmake/service/client.conf
{
    remote_build = {
        connect = "127.0.0.1:9691",
        token = "e438d816c95958667747c318f1532c0f"
    }
}
</code></pre>
<h3 id="">ç”¨æˆ·è®¤è¯å’Œæˆæƒ</h3>
<p>!> 2.6.6 ä»¥ä¸Šç‰ˆæœ¬æ‰æ”¯æŒç”¨æˆ·è®¤è¯ï¼Œ2.6.5 ç‰ˆæœ¬åªèƒ½åŒ¿åè¿æ¥ã€‚</p>
<p>åœ¨å®é™…è¿æ¥ä¹‹å‰ï¼Œæˆ‘ä»¬ç®€å•ä»‹ç»ä¸‹ xmake æä¾›çš„æœåŠ¡ç›®å‰æä¾›çš„å‡ ç§è®¤è¯æœºåˆ¶ã€‚</p>
<ol>
<li>Token è®¤è¯</li>
<li>å¯†ç è®¤è¯</li>
<li>å¯ä¿¡ä¸»æœºéªŒè¯</li>
</ol>
<h4 id="token">Token è®¤è¯</h4>
<p>è¿™ä¹Ÿæ˜¯æˆ‘ä»¬é»˜è®¤æ¨èçš„æ–¹å¼ï¼Œæ›´åŠ å®‰å…¨ï¼Œé…ç½®å’Œè¿æ¥ä¹Ÿæ›´åŠ æ–¹ä¾¿ï¼Œæ¯æ¬¡è¿æ¥ä¹Ÿä¸ç”¨è¾“å…¥å¯†ç ã€‚</p>
<p>æˆ‘ä»¬åœ¨æ‰§è¡Œ <code>xmake service</code> å‘½ä»¤æ—¶å€™ï¼Œé»˜è®¤å°±ä¼šç”Ÿæˆä¸€ä¸ªæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯çš„é…ç½®æ–‡ä»¶ï¼Œå¹¶ä¸”è‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªé»˜è®¤çš„ tokenï¼Œå› æ­¤æœ¬åœ°ç›´è¿æ˜¯ä¸éœ€è¦ä»»ä½•é…ç½®çš„ã€‚</p>
<h5 id="">æœåŠ¡ç«¯è®¤è¯é…ç½®</h5>
<p>æœåŠ¡ç«¯å¯ä»¥é…ç½®å¤šä¸ª token ç”¨äºå¯¹ä¸åŒç”¨æˆ·ä¸»æœºè¿›è¡Œæˆæƒè¿æ¥ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥å…±ç”¨ä¸€ä¸ª tokenã€‚</p>
<pre><code class="lang-bash">$ cat ~/.xmake/service/server.conf
{
    known_hosts = { },
    logfile = "/Users/ruki/.xmake/service/server/logs.txt",
    remote_build = {
        listen = "0.0.0.0:9691",
        workdir = "/Users/ruki/.xmake/service/server/remote_build"
    },
    tokens = {
        "e438d816c95958667747c318f1532c0f"
    }
}
</code></pre>
<h5 id="">å®¢æˆ·ç«¯è®¤è¯é…ç½®</h5>
<p>å®¢æˆ·ç«¯åªéœ€è¦æ·»åŠ æœåŠ¡å™¨ä¸Šçš„ token åˆ°å¯¹åº”çš„å®¢æˆ·ç«¯é…ç½®ä¸­å³å¯ã€‚</p>
<pre><code class="lang-bash">$ cat ~/.xmake/service/client.conf
{
    remote_build = {
        connect = "127.0.0.1:9691",
        token = "e438d816c95958667747c318f1532c0f"
    }
}
</code></pre>
<h5 id="token">æ‰‹åŠ¨ç”Ÿæˆæ–° token</h5>
<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œæ‰‹åŠ¨ç”Ÿæˆä¸€ä¸ªæ–°çš„ tokenï¼Œè‡ªå·±æ·»åŠ åˆ°æœåŠ¡å™¨é…ç½®ä¸­ã€‚</p>
<pre><code class="lang-bash">$ xmake service --gen-token
New token a7b9fc2d3bfca1472aabc38bb5f5d612 is generated!
</code></pre>
<h4 id="">å¯†ç è®¤è¯</h4>
<p>æˆ‘ä»¬ä¹Ÿæä¾›å¯†ç è®¤è¯çš„æˆæƒæ¨¡å¼ï¼Œç›¸æ¯” token è®¤è¯ï¼Œå®ƒéœ€è¦ç”¨æˆ·æ¯æ¬¡è¿æ¥çš„æ—¶å€™ï¼Œè¾“å…¥å¯†ç ï¼ŒéªŒè¯é€šè¿‡åï¼Œæ‰èƒ½è¿æ¥ä¸Šã€‚</p>
<h5 id="">æœåŠ¡ç«¯è®¤è¯é…ç½®</h5>
<p>å¯†ç è®¤è¯ï¼Œæˆ‘ä»¬ä¸éœ€è¦æ‰‹åŠ¨é…ç½® tokenï¼Œåªéœ€è¦æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œæ·»åŠ ç”¨æˆ·å°±è¡Œäº†ï¼Œæ·»åŠ è¿‡ç¨‹ä¸­ï¼Œä¼šæç¤ºç”¨æˆ·è¾“å…¥å¯†ç ã€‚</p>
<pre><code class="lang-bash">$ xmake service --add-user=ruki
Please input user ruki password:
123456
Add user ruki ok!
</code></pre>
<p>ç„¶åï¼Œxmake å°±ä¼šé€šè¿‡ç”¨æˆ·åï¼Œå¯†ç ç”Ÿæˆä¸€ä¸ªæ–°çš„ token æ·»åŠ åˆ°æœåŠ¡å™¨é…ç½®çš„ token åˆ—è¡¨ä¸­å»ã€‚</p>
<pre><code class="lang-bash">$ cat ~/.xmake/service/server.conf
{
    known_hosts = { },
    logfile = "/Users/ruki/.xmake/service/server/logs.txt",
    remote_build = {
        listen = "0.0.0.0:9691",
        workdir = "/Users/ruki/.xmake/service/server/remote_build"
    },
    tokens = {
        "e438d816c95958667747c318f1532c0f",
        "7889e25402413e93fd37395a636bf942"
    }
}
</code></pre>
<p>å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åˆ é™¤æŒ‡å®šçš„ç”¨æˆ·å’Œå¯†ç ã€‚</p>
<pre><code class="lang-bash">$xmake service --rm-user=ruki
Please input user ruki password:
123456
Remove user ruki ok!
</code></pre>
<h5 id="">å®¢æˆ·ç«¯è®¤è¯é…ç½®</h5>
<p>å¯¹äºå®¢æˆ·ç«¯ï¼Œæˆ‘ä»¬ä¸å†éœ€è¦è®¾ç½®æœåŠ¡å™¨çš„ token äº†ï¼Œåªéœ€è¦åœ¨è¿æ¥é…ç½®ä¸­ï¼Œè¿½åŠ éœ€è¦è¿æ¥çš„ç”¨æˆ·åå³å¯å¼€å¯å¯†ç è®¤è¯ï¼Œæ ¼å¼ï¼š<code>user@address:port</code></p>
<pre><code class="lang-bash">$ cat ~/.xmake/service/client.conf
{
    remote_build = {
        connect = "root@127.0.0.1:9691"
  }
}
</code></pre>
<p>!> å¦‚æœå»æ‰ç”¨æˆ·åï¼Œä¹Ÿæ²¡é…ç½® tokenï¼Œé‚£å°±æ˜¯åŒ¿åæ¨¡å¼ï¼Œå¦‚æœæœåŠ¡å™¨ä¹Ÿæ²¡é…ç½® tokenï¼Œå°±æ˜¯å®Œå…¨ç¦ç”¨è®¤è¯ï¼Œç›´æ¥è¿æ¥ã€‚</p>
<h4 id="">å¯ä¿¡ä¸»æœºéªŒè¯</h4>
<p>å¦å¤–ï¼Œä¸ºäº†æ›´è¿›ä¸€æ­¥æé«˜å®‰å…¨æ€§ï¼Œæˆ‘ä»¬è¿˜æä¾›äº†æœåŠ¡ç«¯å¯ä¿¡ä¸»æœºéªŒè¯ï¼Œå¦‚æœåœ¨æœåŠ¡å™¨é…ç½®çš„ known_hosts åˆ—è¡¨ä¸­ï¼Œé…ç½®äº†å¯ä»¥è¿æ¥çš„å®¢æˆ·ç«¯ä¸»æœº ip åœ°å€ï¼Œ<br>é‚£ä¹ˆåªæœ‰è¿™äº›ä¸»æœºå¯ä»¥æˆåŠŸè¿æ¥ä¸Šè¿™å°æœåŠ¡å™¨ï¼Œå…¶ä»–ä¸»æœºå¯¹å®ƒçš„è¿æ¥éƒ½ä¼šè¢«æç¤ºä¸ºä¸å¯ä¿¡è€Œæ‹’ç»è¿æ¥ï¼Œå³ä½¿ token å’Œå¯†ç è®¤è¯éƒ½æ²¡é—®é¢˜ä¹Ÿä¸è¡Œã€‚</p>
<pre><code class="lang-bash">$ cat ~/.xmake/service/server.conf
{
    logfile = "/Users/ruki/.xmake/service/logs.txt",
    server = {
        tokens = {
            "4b928c7563a0cba10ff4c3f5ca0c8e24"
        },
        known_hosts = { "127.0.0.1", "xx.xx.xx.xx"}
    }
}
</code></pre>
<h3 id="">è¿æ¥è¿œç¨‹çš„æœåŠ¡å™¨</h3>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åªéœ€è¦è¿›å…¥éœ€è¦è¿œç¨‹ç¼–è¯‘çš„å·¥ç¨‹æ ¹ç›®å½•ï¼Œæ‰§è¡Œ <code>xmake service --connect</code> å‘½ä»¤ï¼Œè¿›è¡Œè¿æ¥ã€‚</p>
<p>å¦‚æœæ˜¯ token è®¤è¯æ¨¡å¼ï¼Œé‚£ä¹ˆä¸éœ€è¦çš„é¢å¤–çš„å¯†ç è¾“å…¥ï¼Œç›´æ¥è¿æ¥ã€‚</p>
<pre><code class="lang-console">$ xmake create test
$ cd test
$ xmake service --connect
<remote_build_client>: connect 192.168.56.110:9091 ..
<remote_build_client>: connected!
<remote_build_client>: sync files in 192.168.56.110:9091 ..
Scanning files ..
Comparing 3 files ..
    [+]: src/main.cpp
    [+]: .gitignore
    [+]: xmake.lua
3 files has been changed!
Archiving files ..
Uploading files with 1372 bytes ..
<remote_build_client>: sync files ok!
</code></pre>
<p>å¦‚æœæ˜¯å¯†ç è®¤è¯ï¼Œé‚£ä¹ˆä¼šæç¤ºç”¨æˆ·è¾“å…¥å¯†ç ï¼Œæ‰èƒ½ç»§ç»­è¿æ¥ã€‚</p>
<pre><code class="lang-bash">$ xmake service --connect
Please input user root password:
000000
<remote_build_client>: connect 127.0.0.1:9691 ..
<remote_build_client>: connected!
<remote_build_client>: sync files in 127.0.0.1:9691 ..
Scanning files ..
Comparing 3 files ..
    [+]: xmake.lua
    [+]: .gitignore
    [+]: src/main.cpp
3 files has been changed!
Archiving files ..
Uploading files with 1591 bytes ..
<remote_build_client>: sync files ok!
</code></pre>
<p>å¦‚æœå¯†ç ä¸å¯¹ï¼Œå°±ä¼šæç¤ºé”™è¯¯ã€‚</p>
<pre><code class="lang-bash">$ xmake service --connect
Please input user root password:
123
<remote_build_client>: connect 127.0.0.1:9691 ..
<remote_build_client>: connect 127.0.0.1:9691 failed, user and password are incorrect!
</code></pre>
<h3 id="">è¿œç¨‹æ„å»ºå·¥ç¨‹</h3>
<p>è¿æ¥æˆåŠŸåï¼Œæˆ‘ä»¬å°±å¯ä»¥åƒæ­£å¸¸æœ¬åœ°ç¼–è¯‘ä¸€æ ·ï¼Œè¿›è¡Œè¿œç¨‹ç¼–è¯‘ã€‚</p>
<pre><code class="lang-console">$ xmake
<remote_build_client>: run xmake in 192.168.56.110:9091 ..
checking for platform ... macosx
checking for architecture ... x86_64
checking for Xcode directory ... /Applications/Xcode.app
checking for Codesign Identity of Xcode ... Apple Development: waruqi@gmail.com (T3NA4MRVPU)
checking for SDK version of Xcode for macosx (x86_64) ... 11.3
checking for Minimal target version of Xcode for macosx (x86_64) ... 11.4
[ 25%]: ccache compiling.release src/main.cpp
[ 50%]: linking.release test
[100%]: build ok!
<remote_build_client>: run command ok!
</code></pre>
<h3 id="">è¿œç¨‹è¿è¡Œç›®æ ‡ç¨‹åº</h3>
<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥åƒæœ¬åœ°è¿è¡Œè°ƒè¯•é‚£æ ·ï¼Œè¿œç¨‹è¿è¡Œè°ƒè¯•ç¼–è¯‘çš„ç›®æ ‡ç¨‹åºã€‚</p>
<pre><code class="lang-console">$ xmake run
<remote_build_client>: run xmake run in 192.168.56.110:9091 ..
hello world!
<remote_build_client>: run command ok!
</code></pre>
<h3 id="">è¿œç¨‹é‡å»ºå·¥ç¨‹</h3>
<pre><code class="lang-console">$ xmake -rv
<remote_build_client>: run xmake -rv in 192.168.56.110:9091 ..
[ 25%]: ccache compiling.release src/main.cpp
/usr/local/bin/ccache /usr/bin/xcrun -sdk macosx clang -c -Qunused-arguments -arch x86_64 -mmacosx-version-min=11.4 -isysroot /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX11.3.sdk -fvisibility=hidden -fvisibility-inlines-hidden -O3 -DNDEBUG -o build/.objs/test/macosx/x86_64/release/src/main.cpp.o src/main.cpp
[ 50%]: linking.release test
"/usr/bin/xcrun -sdk macosx clang++" -o build/macosx/x86_64/release/test build/.objs/test/macosx/x86_64/release/src/main.cpp.o -arch x86_64 -mmacosx-version-min=11.4 -isysroot /Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX11.3.sdk -stdlib=libc++ -Wl,-x -lz
[100%]: build ok!
<remote_build_client>: run command ok!
</code></pre>
<h3 id="">è¿œç¨‹é…ç½®ç¼–è¯‘å‚æ•°</h3>
<pre><code class="lang-console">$ xmake f --xxx --yy
</code></pre>
<h3 id="">æ‰‹åŠ¨åŒæ­¥å·¥ç¨‹æ–‡ä»¶</h3>
<p>è¿æ¥çš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨åŒæ­¥ä¸€æ¬¡ä»£ç ï¼ŒåæœŸä»£ç æ”¹åŠ¨ï¼Œå¯ä»¥æ‰§è¡Œæ­¤å‘½ä»¤æ¥æ‰‹åŠ¨åŒæ­¥æ”¹åŠ¨çš„æ–‡ä»¶ã€‚</p>
<pre><code class="lang-console">$ xmake service --sync
<remote_build_client>: sync files in 192.168.56.110:9091 ..
Scanning files ..
Comparing 3 files ..
    [+]: src/main.cpp
    [+]: .gitignore
    [+]: xmake.lua
3 files has been changed!
Archiving files ..
Uploading files with 1372 bytes ..
<remote_build_client>: sync files ok!
</code></pre>
<h3 id="">æ–­å¼€è¿œç¨‹è¿æ¥</h3>
<p>é’ˆå¯¹å½“å‰å·¥ç¨‹ï¼Œæ–­å¼€è¿æ¥ï¼Œè¿™ä»…ä»…å½±å“å½“å‰å·¥ç¨‹ï¼Œå…¶ä»–é¡¹ç›®è¿˜æ˜¯å¯ä»¥åŒæ—¶è¿æ¥å’Œç¼–è¯‘ã€‚</p>
<pre><code class="lang-console">$ xmake service --disconnect
<remote_build_client>: disconnect 192.168.56.110:9091 ..
<remote_build_client>: disconnected!
</code></pre>
<h3 id="">æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—</h3>
<pre><code class="lang-console">$ xmake service --logs
</code></pre>
<h3 id="">æ¸…ç†è¿œç¨‹æœåŠ¡ç¼“å­˜å’Œæ„å»ºæ–‡ä»¶</h3>
<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥æ‰‹åŠ¨æ¸…ç†è¿œç¨‹çš„ä»»ä½•ç¼“å­˜å’Œæ„å»ºç”Ÿæˆçš„æ–‡ä»¶ã€‚</p>
<pre><code class="lang-console">$ cd projectdir
$ xmake service --clean
</code></pre>
<h2 id="">åˆ†å¸ƒå¼ç¼–è¯‘</h2>
<p>Xmake æä¾›äº†å†…ç½®çš„åˆ†å¸ƒå¼ç¼–è¯‘æœåŠ¡ï¼Œé€šå¸¸å®ƒå¯ä»¥è·Ÿ æœ¬åœ°ç¼–è¯‘ç¼“å­˜ï¼Œè¿œç¨‹ç¼–è¯‘ç¼“å­˜ ç›¸äº’é…åˆï¼Œå®ç°æœ€ä¼˜çš„ç¼–è¯‘çš„åŠ é€Ÿã€‚</p>
<p>å¦å¤–ï¼Œå®ƒæ˜¯å®Œå…¨è·¨å¹³å°æ”¯æŒï¼Œæˆ‘ä»¬ä¸ä»…æ”¯æŒ gcc/clangï¼Œä¹Ÿèƒ½å¤Ÿå¾ˆå¥½åœ°æ”¯æŒ Windows å’Œ msvcã€‚</p>
<p>å¯¹äºäº¤å‰ç¼–è¯‘ï¼Œåªè¦äº¤å‰å·¥å…·é“¾æ”¯æŒï¼Œæˆ‘ä»¬ä¸è¦æ±‚æœåŠ¡å™¨çš„ç³»ç»Ÿç¯å¢ƒï¼Œå³ä½¿æ··ç”¨ linux, macOS å’Œ Windows çš„æœåŠ¡å™¨èµ„æºï¼Œä¹Ÿå¯ä»¥å¾ˆå¥½çš„å®ç°åˆ†å¸ƒå¼ç¼–è¯‘ã€‚</p>
<h3 id="">å¼€å¯æœåŠ¡</h3>
<p>æˆ‘ä»¬å¯ä»¥æŒ‡å®š <code>--distcc</code> å‚æ•°æ¥å¼€å¯åˆ†å¸ƒå¼ç¼–è¯‘æœåŠ¡ï¼Œå½“ç„¶å¦‚æœä¸æŒ‡å®šè¿™ä¸ªå‚æ•°ï¼Œxmake ä¼šé»˜è®¤å¼€å¯æ‰€æœ‰æœåŠ¡ç«¯é…ç½®çš„æœåŠ¡ã€‚</p>
<pre><code class="lang-console">$ xmake service --distcc
<distcc_build_server>: listening 0.0.0.0:9093 ..
</code></pre>
<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥å¼€å¯æœåŠ¡çš„åŒæ—¶ï¼Œå›æ˜¾è¯¦ç»†æ—¥å¿—ä¿¡æ¯ã€‚</p>
<pre><code class="lang-console">$ xmake service --distcc -vD
<distcc_build_server>: listening 0.0.0.0:9093 ..
</code></pre>
<h3 id="daemon">ä»¥ Daemon æ¨¡å¼å¼€å¯æœåŠ¡</h3>
<pre><code class="lang-console">$ xmake service --distcc --start
$ xmake service --distcc --restart
$ xmake service --distcc --stop
</code></pre>
<h3 id="">é…ç½®æœåŠ¡ç«¯</h3>
<p>æˆ‘ä»¬é¦–å…ˆï¼Œè¿è¡Œ <code>xmake service</code> å‘½ä»¤ï¼Œå®ƒä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªé»˜è®¤çš„ <code>server.conf</code> é…ç½®æ–‡ä»¶ï¼Œå­˜å‚¨åˆ° <code>~/.xmake/service/server.conf</code>ã€‚</p>
<pre><code class="lang-bash">$ xmake service
generating the config file to /Users/ruki/.xmake/service/server.conf ..
an token(590234653af52e91b9e438ed860f1a2b) is generated, we can use this token to connect service.
generating the config file to /Users/ruki/.xmake/service/client.conf ..
<distcc_build_server>: listening 0.0.0.0:9693 ..
</code></pre>
<p>ç„¶åï¼Œæˆ‘ä»¬ç¼–è¾‘å®ƒï¼Œä¿®å¤æœåŠ¡å™¨çš„ç›‘å¬ç«¯å£ï¼ˆå¯é€‰ï¼‰ã€‚</p>
<pre><code class="lang-bash">$ cat ~/.xmake/service/server.conf
{
    distcc_build = {
        listen = "0.0.0.0:9693",
        workdir = "/Users/ruki/.xmake/service/server/distcc_build"
    },
    known_hosts = { },
    logfile = "/Users/ruki/.xmake/service/server/logs.txt",
    tokens = {
        "590234653af52e91b9e438ed860f1a2b"
    }
}
</code></pre>
<h3 id="">é…ç½®å®¢æˆ·ç«¯</h3>
<p>å®¢æˆ·ç«¯é…ç½®æ–‡ä»¶åœ¨ <code>~/.xmake/service/client.conf</code>ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨é‡Œé¢é…ç½®å®¢æˆ·ç«¯éœ€è¦è¿æ¥çš„æœåŠ¡å™¨åœ°å€ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥åœ¨ hosts åˆ—è¡¨é‡Œé¢é…ç½®å¤šä¸ªæœåŠ¡å™¨åœ°å€ï¼Œä»¥åŠå¯¹åº”çš„ tokenã€‚</p>
<p>!> åˆ†å¸ƒå¼ç¼–è¯‘ï¼Œæ¨èä½¿ç”¨ token è®¤è¯æ¨¡å¼ï¼Œå› ä¸ºå¯†ç æ¨¡å¼ï¼Œæ¯å°æœåŠ¡å™¨è¿æ¥æ—¶å€™éƒ½è¦è¾“å…¥ä¸€æ¬¡å¯†ç ï¼Œå¾ˆç¹çã€‚</p>
<pre><code class="lang-console">$cat ~/.xmake/service/client.conf
{
    distcc_build = {
        hosts = {
            {
                connect = "127.0.0.1:9693",
                token = "590234653af52e91b9e438ed860f1a2b"
            }
        }
    }
}
</code></pre>
<h3 id="">ç”¨æˆ·è®¤è¯å’Œæˆæƒ</h3>
<p>å…³äºç”¨æˆ·è®¤è¯å’Œæˆæƒï¼Œå¯ä»¥å‚è€ƒ [è¿œç¨‹ç¼–è¯‘/ç”¨æˆ·è®¤è¯å’Œæˆæƒ] é‡Œé¢çš„è¯¦ç»†è¯´æ˜ï¼Œç”¨æ³•æ˜¯å®Œå…¨ä¸€è‡´çš„ã€‚</p>
<h3 id="">è¿æ¥æœåŠ¡å™¨</h3>
<p>é…ç½®å®Œè®¤è¯å’ŒæœåŠ¡å™¨åœ°å€åï¼Œå°±å¯ä»¥è¾“å…¥ä¸‹é¢çš„å‘½ä»¤ï¼Œå°†å½“å‰å·¥ç¨‹è¿æ¥åˆ°é…ç½®çš„æœåŠ¡å™¨ä¸Šäº†ã€‚</p>
<p>æˆ‘ä»¬éœ€è¦åœ¨è¿æ¥æ—¶å€™ï¼Œè¾“å…¥ <code>--distcc</code>ï¼ŒæŒ‡å®šä»…ä»…è¿æ¥åˆ†å¸ƒå¼æœåŠ¡ã€‚</p>
<pre><code class="lang-bash">$ cd projectdir
$ xmake service --connect --distcc
<client>: connect 127.0.0.1:9693 ..
<client>: 127.0.0.1:9693 connected!
</code></pre>
<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥åŒæ—¶è¿æ¥å¤šä¸ªæœåŠ¡ï¼Œæ¯”å¦‚åˆ†å¸ƒå¼ç¼–è¯‘å’Œè¿œç¨‹ç¼–è¯‘ç¼“å­˜æœåŠ¡ã€‚</p>
<pre><code class="lang-hash">$ xmake service --connect --distcc --ccache
</code></pre>
<p>!> å¦‚æœä¸å¸¦ä»»ä½•å‚æ•°ï¼Œé»˜è®¤è¿æ¥çš„æ˜¯è¿œç¨‹ç¼–è¯‘æœåŠ¡ã€‚</p>
<h3 id="">åˆ†å¸ƒå¼ç¼–è¯‘é¡¹ç›®</h3>
<p>è¿æ¥ä¸ŠæœåŠ¡å™¨åï¼Œæˆ‘ä»¬å°±å¯ä»¥åƒæ­£å¸¸æœ¬åœ°ç¼–è¯‘é‚£æ ·ï¼Œè¿›è¡Œåˆ†å¸ƒå¼ç¼–è¯‘äº†ï¼Œä¾‹å¦‚ï¼š</p>
<pre><code class="lang-bash">$ xmake
...
[ 93%]: ccache compiling.release src/demo/network/unix_echo_client.c         ----> local job
[ 93%]: ccache compiling.release src/demo/network/ipv6.c
[ 93%]: ccache compiling.release src/demo/network/ping.c
[ 93%]: distcc compiling.release src/demo/network/unix_echo_server.c.         ----> distcc job
[ 93%]: distcc compiling.release src/demo/network/http.c
[ 93%]: distcc compiling.release src/demo/network/unixaddr.c
[ 93%]: distcc compiling.release src/demo/network/ipv4.c
[ 94%]: distcc compiling.release src/demo/network/ipaddr.c
[ 94%]: distcc compiling.release src/demo/math/fixed.c
[ 94%]: distcc compiling.release src/demo/libm/float.c
[ 95%]: ccache compiling.release src/demo/libm/double.c
[ 95%]: ccache compiling.release src/demo/other/test.cpp
[ 98%]: archiving.release libtbox.a
[ 99%]: linking.release demo
[100%]: build ok!
</code></pre>
<p>å…¶ä¸­ï¼Œå¸¦æœ‰ distcc å­—æ ·çš„æ˜¯è¿œç¨‹ç¼–è¯‘ä»»åŠ¡ï¼Œå…¶ä»–çš„éƒ½æ˜¯æœ¬åœ°ç¼–è¯‘ä»»åŠ¡ï¼Œé»˜è®¤ xmake è¿˜å¼€å¯äº†æœ¬åœ°ç¼–è¯‘ç¼“å­˜ï¼Œå¯¹åˆ†å¸ƒå¼ç¼–è¯‘ç»“æœè¿›è¡Œç¼“å­˜ï¼Œé¿å…é¢‘ç¹è¯·æ±‚æœåŠ¡å™¨ã€‚</p>
<p>å¦å¤–ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å¼€å¯è¿œç¨‹ç¼–è¯‘ç¼“å­˜ï¼Œè·Ÿå…¶ä»–äººå…±äº«ç¼–è¯‘ç¼“å­˜ï¼Œè¿›ä¸€æ­¥åŠ é€Ÿå¤šäººååŒå¼€å‘çš„ç¼–è¯‘ã€‚</p>
<h3 id="">æ–­å¼€è¿æ¥</h3>
<pre><code class="lang-bash">$ xmake service --disconnect --distcc
</code></pre>
<h3 id="">æŒ‡å®šå¹¶è¡Œç¼–è¯‘ä»»åŠ¡æ•°</h3>
<p>æˆ‘ä»¬å…ˆç®€å•ä»‹ç»ä¸‹ï¼Œç›®å‰æ ¹æ®ä¸»æœº cpu core æ•°é‡é»˜è®¤è®¡ç®—çš„å¹¶è¡Œä»»åŠ¡æ•°ï¼š</p>
<pre><code class="lang-lua">local default_njob = math.ceil(ncpu * 3 / 2)
</code></pre>
<p>å› æ­¤ï¼Œå¦‚æœä¸å¼€å¯åˆ†å¸ƒå¼ç¼–è¯‘ï¼Œé»˜è®¤çš„æœ€å¤§å¹¶è¡Œç¼–è¯‘ä»»åŠ¡æ•°å°±æ˜¯è¿™ä¸ª default_njobã€‚</p>
<p>å¦‚æœå¼€å¯åˆ†å¸ƒå¼ç¼–è¯‘åï¼Œé»˜è®¤çš„å¹¶è¡Œç¼–è¯‘ä»»åŠ¡æ•°å°±æ˜¯ï¼š</p>
<pre><code class="lang-lua">local maxjobs = default_njob + server_count * server_default_njob
</code></pre>
<h4 id="">ä¿®æ”¹æœ¬åœ°å¹¶è¡Œä»»åŠ¡æ•°</h4>
<p>æˆ‘ä»¬åªéœ€è¦é€šè¿‡ <code>-jN</code> å°±èƒ½æŒ‡å®šæœ¬åœ°å¹¶è¡Œä»»åŠ¡æ•°ï¼Œä½†æ˜¯å®ƒä¸ä¼šå½±å“æœåŠ¡ç«¯çš„å¹¶è¡Œä»»åŠ¡æ•°ã€‚</p>
<pre><code class="lang-bash">$ xmake -jN
</code></pre>
<h4 id="">ä¿®æ”¹æœåŠ¡ç«¯å¹¶è¡Œä»»åŠ¡æ•°</h4>
<p>å¦‚æœè¦ä¿®æ”¹æœåŠ¡ç«¯çš„å¹¶è¡Œä»»åŠ¡æ•°ï¼Œéœ€è¦ä¿®æ”¹å®¢æˆ·ç«¯çš„é…ç½®æ–‡ä»¶ã€‚</p>
<pre><code class="lang-bash">$cat ~/.xmake/service/client.conf
{
    distcc_build = {
        hosts = {
            {
                connect = "127.0.0.1:9693",
                token = "590234653af52e91b9e438ed860f1a2b",
                njob = 8   <------- modify here
            },
            {
                connect = "192.168.01:9693",
                token = "590234653af52e91b9e438ed860f1a2b",
                njob = 4
            }
        }
    }
}
</code></pre>
<p>å¯ä»¥å¯¹æ¯ä¸ªæœåŠ¡å™¨ä¸»æœºï¼Œæ·»åŠ  <code>njob = N</code> å‚æ•°é…ç½®ï¼ŒæŒ‡å®šè¿™å°æœåŠ¡å™¨å¯ä»¥æä¾›çš„å¹¶è¡Œä»»åŠ¡æ•°ã€‚</p>
<h3 id="android">åˆ†å¸ƒå¼ç¼–è¯‘ Android é¡¹ç›®</h3>
<p>xmake æä¾›çš„åˆ†å¸ƒå¼ç¼–è¯‘æœåŠ¡æ˜¯å®Œå…¨è·¨å¹³å°çš„ï¼Œå¹¶ä¸”æ”¯æŒ Windows, Linux, macOS, Android, iOS ç”šè‡³äº¤å‰ç¼–è¯‘ã€‚</p>
<p>å¦‚æœè¦è¿›è¡Œ Android é¡¹ç›®ç¼–è¯‘ï¼Œåªéœ€è¦åœ¨æœåŠ¡ç«¯é…ç½®ä¸­ï¼Œå¢åŠ  <code>toolchains</code> å·¥å…·é“¾é…ç½®ï¼Œæä¾› NDK çš„è·Ÿè·¯å¾„å³å¯ã€‚</p>
<pre><code class="lang-bash">$ cat ~/.xmake/service/server.conf
{
    distcc_build = {
        listen = "0.0.0.0:9693",
        toolchains = {
            ndk = {
                ndk = "~/files/android-ndk-r21e"   <------------ here
            }
        },
        workdir = "/Users/ruki/.xmake/service/server/distcc_build"
    },
    known_hosts = { },
    logfile = "/Users/ruki/.xmake/service/server/logs.txt",
    tokens = {
        "590234653af52e91b9e438ed860f1a2b"
    }
}
</code></pre>
<p>ç„¶åï¼Œæˆ‘ä»¬å°±å¯ä»¥åƒæ­£å¸¸æœ¬åœ°ç¼–è¯‘é‚£æ ·ï¼Œåˆ†å¸ƒå¼ç¼–è¯‘ Android é¡¹ç›®ï¼Œç”šè‡³å¯ä»¥é…ç½®å¤šå° Windows, macOS, Linux ç­‰ä¸åŒçš„æœåŠ¡å™¨ä¸»æœºï¼Œåšä¸ºåˆ†å¸ƒå¼ç¼–è¯‘æœåŠ¡çš„èµ„æºï¼Œæ¥ç¼–è¯‘å®ƒã€‚</p>
<p>åªéœ€è¦ä¸‹è½½å¯¹åº”å¹³å°çš„ NDK å°±è¡Œäº†ã€‚</p>
<pre><code class="lang-bash">$ xmake f -p android --ndk=~/files/xxxx
$ xmake
</code></pre>
<h3 id="ios">åˆ†å¸ƒå¼ç¼–è¯‘ iOS é¡¹ç›®</h3>
<p>ç¼–è¯‘ iOS é¡¹ç›®æ›´åŠ ç®€å•ï¼Œå› ä¸º Xmake é€šå¸¸èƒ½è‡ªåŠ¨æ£€æµ‹åˆ° Xcodeï¼Œæ‰€ä»¥åªéœ€è¦åƒæ­£å¸¸æœ¬åœ°ä¸€æ ·ï¼Œåˆ‡ä¸€ä¸‹å¹³å°åˆ° ios å³å¯ã€‚</p>
<pre><code class="lang-bash">$ xmake f -p iphoneos
$ xmake
</code></pre>
<h3 id="">åˆ†å¸ƒå¼äº¤å‰ç¼–è¯‘é…ç½®</h3>
<p>å¦‚æœè¦åˆ†å¸ƒå¼äº¤å‰ç¼–è¯‘ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æœåŠ¡ç«¯é…ç½®å·¥å…·é“¾ sdk è·¯å¾„ï¼Œä¾‹å¦‚ï¼š</p>
<pre><code class="lang-bash">$ cat ~/.xmake/service/server.conf
{
    distcc_build = {
        listen = "0.0.0.0:9693",
        toolchains = {
            cross = {
                sdkdir = "~/files/arm-linux-xxx"   <------------ here
            }
        },
        workdir = "/Users/ruki/.xmake/service/server/distcc_build"
    },
    known_hosts = { },
    logfile = "/Users/ruki/.xmake/service/server/logs.txt",
    tokens = {
        "590234653af52e91b9e438ed860f1a2b"
    }
}
</code></pre>
<p>å…¶ä¸­ï¼Œtoolchains ä¸‹ï¼Œæ¯ä¸€é¡¹å¯¹åº”ä¸€ä¸ªå·¥å…·é“¾ï¼Œè¿™é‡Œé…ç½®ä¸º <code>cross = {}</code> äº¤å‰å·¥å…·é“¾ï¼Œå¯¹åº” <code>toolchain("cross")</code>ã€‚</p>
<p>å·¥å…·é“¾é‡Œé¢æˆ‘ä»¬å¯ä»¥é…ç½® <code>sdkdir</code>, <code>bindir</code>, <code>cross</code> ç­‰ç­‰ï¼Œå¯¹åº” <code>toolchain("cross")</code> é‡Œé¢çš„ <code>set_sdkdir</code>, <code>set_bindir</code> å’Œ <code>set_cross</code> ç­‰æ¥å£é…ç½®ã€‚</p>
<p>å¦‚æœäº¤å‰å·¥å…·é“¾æ¯”è¾ƒè§„èŒƒï¼Œæˆ‘ä»¬é€šå¸¸åªéœ€è¦é…ç½® <code>sdkdir</code>ï¼Œxmake å°±èƒ½è‡ªåŠ¨æ£€æµ‹åˆ°ã€‚</p>
<p>è€Œå®¢æˆ·ç«¯ç¼–è¯‘ä¹Ÿåªéœ€è¦æŒ‡å®š sdk ç›®å½•ã€‚</p>
<pre><code class="lang-bash">$ xmake f -p cross --sdk=/xxx/arm-linux-xxx
$ xmake
</code></pre>
<h3 id="">æ¸…ç†æœåŠ¡å™¨ç¼“å­˜</h3>
<p>æ¯ä¸ªé¡¹ç›®åœ¨æœåŠ¡ç«¯çš„ç¼–è¯‘ï¼Œéƒ½ä¼šäº§ç”Ÿä¸€äº›ç¼“å­˜æ–‡ä»¶ï¼Œä»–ä»¬éƒ½æ˜¯æŒ‰å·¥ç¨‹ç²’åº¦åˆ†åˆ«å­˜å‚¨çš„ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤ï¼Œå¯¹å½“å‰å·¥ç¨‹æ¸…ç†æ¯ä¸ªæœåŠ¡å™¨å¯¹åº”çš„ç¼“å­˜ã€‚</p>
<pre><code class="lang-bash">$ xmake service --clean --distcc
</code></pre>
<h3 id="">ä¸€äº›å†…éƒ¨ä¼˜åŒ–</h3>
<ol>
<li>ç¼“å­˜æœåŠ¡å™¨ç«¯ç¼–è¯‘ç»“æœï¼Œé¿å…é‡å¤ç¼–è¯‘</li>
<li>æœ¬åœ°ç¼“å­˜ï¼Œè¿œç¨‹ç¼“å­˜ä¼˜åŒ–ï¼Œé¿å…ä¸å¿…è¦çš„æœåŠ¡ç«¯é€šä¿¡</li>
<li>æœåŠ¡å™¨è´Ÿè½½å‡è¡¡è°ƒåº¦ï¼Œåˆç†åˆ†é…æœåŠ¡å™¨èµ„æº</li>
<li>é¢„å¤„ç†åå°æ–‡ä»¶ç›´æ¥æœ¬åœ°ç¼–è¯‘ï¼Œé€šå¸¸ä¼šæ›´å¿«</li>
<li>å¤§æ–‡ä»¶å®æ—¶å‹ç¼©ä¼ è¾“ï¼ŒåŸºäº lz4 å¿«é€Ÿå‹ç¼©</li>
<li>å†…éƒ¨çŠ¶æ€ç»´æŠ¤ï¼Œç›¸æ¯” distcc ç­‰ç‹¬ç«‹å·¥å…·ï¼Œé¿å…äº†é¢‘ç¹çš„ç‹¬ç«‹è¿›ç¨‹åŠ è½½è€—æ—¶ï¼Œä¹Ÿé¿å…äº†ä¸å®ˆæŠ¤è¿›ç¨‹é¢å¤–çš„é€šä¿¡</li>
</ol>
<h2 id="">æœ¬åœ°ç¼–è¯‘ç¼“å­˜</h2>
<p>é»˜è®¤ï¼ŒXmake å°±ä¼šå¼€å¯æœ¬åœ°ç¼“å­˜ï¼Œ2.6.5 ä¹‹å‰çš„ç‰ˆæœ¬é»˜è®¤ä½¿ç”¨å¤–ç½®çš„ ccacheï¼Œè€Œ 2.6.6 ä¹‹åç‰ˆæœ¬ï¼ŒXmake æä¾›äº†å†…ç½®çš„è·¨å¹³å°æœ¬åœ°ç¼“å­˜æ–¹æ¡ˆã€‚</p>
<p>ç›¸æ¯” ccache ç­‰ç¬¬ä¸‰æ–¹ç‹¬ç«‹è¿›ç¨‹ï¼Œxmake å†…éƒ¨çŠ¶æ€ç»´æŠ¤ï¼Œæ›´åŠ ä¾¿äºä¼˜åŒ–ï¼Œä¹Ÿé¿å…äº†é¢‘ç¹çš„ç‹¬ç«‹è¿›ç¨‹åŠ è½½è€—æ—¶ï¼Œä¹Ÿé¿å…äº†ä¸å®ˆæŠ¤è¿›ç¨‹é¢å¤–çš„é€šä¿¡ã€‚</p>
<p>å¦å¤–ï¼Œå†…ç½®çš„ç¼“å­˜èƒ½å¤Ÿæ›´å¥½çš„æ”¯æŒè·¨å¹³å°ï¼ŒWindows ä¸Š msvc ä¹Ÿèƒ½å¤Ÿå¾ˆå¥½çš„æ”¯æŒï¼Œè€Œ ccache ä»…ä»…æ”¯æŒ gcc/clangã€‚</p>
<p>å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤ç¦ç”¨ç¼“å­˜ã€‚</p>
<pre><code class="lang-bash">$ xmake f --ccache=n
</code></pre>
<p>æ³¨ï¼šä¸ç®¡æ˜¯å¦ä½¿ç”¨å†…ç½®æœ¬åœ°ç¼“å­˜ï¼Œé…ç½®åéƒ½æ˜¯ <code>--ccache=</code>ï¼Œæ„æ€æ˜¯ c/c++ æ„å»ºç¼“å­˜ï¼Œè€Œä¸ä»…ä»…æ˜¯æŒ‡ ccache å·¥å…·çš„åå­—ã€‚</p>
<p>æˆ‘ä»¬å¦‚æœæƒ³ç»§ç»­ä½¿ç”¨å¤–ç½®çš„å…¶ä»–ç¼“å­˜å·¥å…·ï¼Œæˆ‘ä»¬ä¹Ÿæ˜¯å¯ä»¥é€šè¿‡ä¸‹é¢çš„æ–¹å¼æ¥é…ç½®ã€‚</p>
<pre><code class="lang-bash">$ xmake f --ccache=n --cxx="ccache gcc" --cc="ccache gcc"
$ xmake
</code></pre>
<h2 id="">è¿œç¨‹ç¼–è¯‘ç¼“å­˜</h2>
<p>é™¤äº†æœ¬åœ°ç¼“å­˜ï¼Œæˆ‘ä»¬ä¹Ÿæä¾›äº†è¿œç¨‹ç¼“å­˜æœåŠ¡ï¼Œç±»ä¼¼ mozilla çš„ sscacheï¼Œå¦‚æœåªæ˜¯ä¸ªäººå¼€å‘ï¼Œå¹³å¸¸ä¸ä¼šç”¨åˆ°å®ƒã€‚</p>
<p>ä½†æ˜¯ï¼Œå¦‚æœæ˜¯å…¬å¸å†…éƒ¨å¤šäººååŒå¼€å‘ä¸€ä¸ªå¤§å‹é¡¹ç›®ï¼Œä»…ä»…é åˆ†å¸ƒå¼ç¼–è¯‘å’Œæœ¬åœ°ç¼“å­˜ï¼Œæ˜¯ä¸å¤Ÿçš„ã€‚æˆ‘ä»¬è¿˜éœ€è¦å¯¹ç¼–è¯‘çš„å¯¹è±¡æ–‡ä»¶ç¼“å­˜åˆ°ç‹¬ç«‹çš„æœåŠ¡å™¨ä¸Šè¿›è¡Œå…±äº«ã€‚</p>
<p>è¿™æ ·ï¼Œå…¶ä»–äººå³ä½¿é¦–æ¬¡ç¼–è¯‘ï¼Œä¹Ÿä¸éœ€è¦æ¯æ¬¡éƒ½å»åˆ†å¸ƒå¼ç¼–è¯‘å®ƒï¼Œç›´æ¥ä»è¿œç¨‹æ‹‰å–ç¼“å­˜æ¥åŠ é€Ÿç¼–è¯‘ã€‚</p>
<p>å¦å¤–ï¼ŒXmake æä¾›çš„è¿œç¨‹ç¼“å­˜æœåŠ¡ï¼Œä¹Ÿæ˜¯å…¨å¹³å°æ”¯æŒçš„ï¼Œä¸ä»…æ”¯æŒ gcc/clang è¿˜æ”¯æŒ msvcã€‚</p>
<h3 id="">å¼€å¯æœåŠ¡</h3>
<p>æˆ‘ä»¬å¯ä»¥æŒ‡å®š <code>--ccache</code> å‚æ•°æ¥å¼€å¯è¿œç¨‹ç¼–è¯‘ç¼“å­˜æœåŠ¡ï¼Œå½“ç„¶å¦‚æœä¸æŒ‡å®šè¿™ä¸ªå‚æ•°ï¼Œxmake ä¼šé»˜è®¤å¼€å¯æ‰€æœ‰æœåŠ¡ç«¯é…ç½®çš„æœåŠ¡ã€‚</p>
<pre><code class="lang-console">$ xmake service --ccache
<remote_cache_server>: listening 0.0.0.0:9092 ..
</code></pre>
<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥å¼€å¯æœåŠ¡çš„åŒæ—¶ï¼Œå›æ˜¾è¯¦ç»†æ—¥å¿—ä¿¡æ¯ã€‚</p>
<pre><code class="lang-console">$ xmake service --ccache -vD
<remote_cache_server>: listening 0.0.0.0:9092 ..
</code></pre>
<h3 id="daemon">ä»¥ Daemon æ¨¡å¼å¼€å¯æœåŠ¡</h3>
<pre><code class="lang-console">$ xmake service --ccache --start
$ xmake service --ccache --restart
$ xmake service --ccache --stop
</code></pre>
<h3 id="">é…ç½®æœåŠ¡ç«¯</h3>
<p>æˆ‘ä»¬é¦–å…ˆï¼Œè¿è¡Œ <code>xmake service</code> å‘½ä»¤ï¼Œå®ƒä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªé»˜è®¤çš„ <code>server.conf</code> é…ç½®æ–‡ä»¶ï¼Œå­˜å‚¨åˆ° <code>~/.xmake/service/server.conf</code>ã€‚</p>
<pre><code class="lang-bash">$ xmake service
generating the config file to /Users/ruki/.xmake/service/server.conf ..
an token(590234653af52e91b9e438ed860f1a2b) is generated, we can use this token to connect service.
generating the config file to /Users/ruki/.xmake/service/client.conf ..
<remote_cache_server>: listening 0.0.0.0:9692 ..
</code></pre>
<p>ç„¶åï¼Œæˆ‘ä»¬ç¼–è¾‘å®ƒï¼Œä¿®å¤æœåŠ¡å™¨çš„ç›‘å¬ç«¯å£ï¼ˆå¯é€‰ï¼‰ã€‚</p>
<pre><code class="lang-bash">$ cat ~/.xmake/service/server.conf
{
    distcc_build = {
        listen = "0.0.0.0:9692",
        workdir = "/Users/ruki/.xmake/service/server/remote_cache"
    },
    known_hosts = { },
    logfile = "/Users/ruki/.xmake/service/server/logs.txt",
    tokens = {
        "590234653af52e91b9e438ed860f1a2b"
    }
}
</code></pre>
<h3 id="">é…ç½®å®¢æˆ·ç«¯</h3>
<p>å®¢æˆ·ç«¯é…ç½®æ–‡ä»¶åœ¨ <code>~/.xmake/service/client.conf</code>ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨é‡Œé¢é…ç½®å®¢æˆ·ç«¯éœ€è¦è¿æ¥çš„æœåŠ¡å™¨åœ°å€ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥åœ¨ hosts åˆ—è¡¨é‡Œé¢é…ç½®å¤šä¸ªæœåŠ¡å™¨åœ°å€ï¼Œä»¥åŠå¯¹åº”çš„ tokenã€‚</p>
<pre><code class="lang-console">$cat ~/.xmake/service/client.conf
{
    remote_cache = {
            connect = "127.0.0.1:9692,
            token = "590234653af52e91b9e438ed860f1a2b"
        }
    }
}
</code></pre>
<h3 id="">ç”¨æˆ·è®¤è¯å’Œæˆæƒ</h3>
<p>å…³äºç”¨æˆ·è®¤è¯å’Œæˆæƒï¼Œå¯ä»¥å‚è€ƒ [è¿œç¨‹ç¼–è¯‘/ç”¨æˆ·è®¤è¯å’Œæˆæƒ] é‡Œé¢çš„è¯¦ç»†è¯´æ˜ï¼Œç”¨æ³•æ˜¯å®Œå…¨ä¸€è‡´çš„ã€‚</p>
<h3 id="">è¿æ¥æœåŠ¡å™¨</h3>
<p>é…ç½®å®Œè®¤è¯å’ŒæœåŠ¡å™¨åœ°å€åï¼Œå°±å¯ä»¥è¾“å…¥ä¸‹é¢çš„å‘½ä»¤ï¼Œå°†å½“å‰å·¥ç¨‹è¿æ¥åˆ°é…ç½®çš„æœåŠ¡å™¨ä¸Šäº†ã€‚</p>
<p>æˆ‘ä»¬éœ€è¦åœ¨è¿æ¥æ—¶å€™ï¼Œè¾“å…¥ <code>--ccache</code>ï¼ŒæŒ‡å®šä»…ä»…è¿æ¥è¿œç¨‹ç¼–è¯‘ç¼“å­˜æœåŠ¡ã€‚</p>
<pre><code class="lang-bash">$ cd projectdir
$ xmake service --connect --ccache
<client>: connect 127.0.0.1:9692 ..
<client>: 127.0.0.1:9692 connected!
</code></pre>
<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥åŒæ—¶è¿æ¥å¤šä¸ªæœåŠ¡ï¼Œæ¯”å¦‚åˆ†å¸ƒå¼ç¼–è¯‘å’Œè¿œç¨‹ç¼–è¯‘ç¼“å­˜æœåŠ¡ã€‚</p>
<pre><code class="lang-hash">$ xmake service --connect --distcc --ccache
</code></pre>
<p>!> å¦‚æœä¸å¸¦ä»»ä½•å‚æ•°ï¼Œé»˜è®¤è¿æ¥çš„æ˜¯è¿œç¨‹ç¼–è¯‘æœåŠ¡ã€‚</p>
<h3 id="">æ–­å¼€è¿æ¥</h3>
<pre><code class="lang-bash">$ xmake service --disconnect --ccache
</code></pre>
<h3 id="">æ¸…ç†æœåŠ¡å™¨ç¼“å­˜</h3>
<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤ï¼Œæ¸…ç†å½“å‰å·¥ç¨‹å¯¹åº”çš„è¿œç¨‹æœåŠ¡å™¨ä¸Šçš„ç¼“å­˜ã€‚</p>
<pre><code class="lang-bash">$ xmake service --clean --ccache
</code></pre>
<p>è€Œå¦‚æœæˆ‘ä»¬æ‰§è¡Œ <code>xmake clean --all</code>ï¼Œåœ¨è¿æ¥äº†è¿œç¨‹æœåŠ¡çš„çŠ¶æ€ä¸‹ï¼Œä¹Ÿä¼šå»è‡ªåŠ¨æ¸…ç†æ‰€æœ‰çš„ç¼“å­˜ã€‚</p>
<h3 id="">ä¸€äº›å†…éƒ¨ä¼˜åŒ–</h3>
<ol>
<li>æ‹‰å–è¿œç¨‹ç¼“å­˜çš„å¿«ç…§ï¼Œé€šè¿‡ bloom filter + lz4 å›ä¼ æœ¬åœ°åï¼Œç”¨äºå¿«é€Ÿåˆ¤æ–­ç¼“å­˜æ˜¯å¦å­˜åœ¨ï¼Œé¿å…é¢‘ç¹çš„æŸ¥è¯¢æœåŠ¡ç«¯ç¼“å­˜ä¿¡æ¯</li>
<li>é…åˆæœ¬åœ°ç¼“å­˜ï¼Œå¯ä»¥é¿å…é¢‘ç¹åœ°è¯·æ±‚è¿œç¨‹æœåŠ¡å™¨ï¼Œæ‹‰å–ç¼“å­˜ã€‚</li>
<li>å†…éƒ¨çŠ¶æ€ç»´æŠ¤ï¼Œç›¸æ¯” sscache ç­‰ç‹¬ç«‹å·¥å…·ï¼Œé¿å…äº†é¢‘ç¹çš„ç‹¬ç«‹è¿›ç¨‹åŠ è½½è€—æ—¶ï¼Œä¹Ÿé¿å…äº†ä¸å®ˆæŠ¤è¿›ç¨‹é¢å¤–çš„é€šä¿¡</li>
</ol>
</article>
</body>
</html>